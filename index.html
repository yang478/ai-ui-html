<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI UI 提示词生成器 Pro | 智能设计助手</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #6366F1;
            --primary-light: #EEF2FF;
            --primary-dark: #4F46E5;
            --secondary-color: #F472B6;
            --accent-color: #34D399;
            --danger-color: #EF4444;
            --warning-color: #F59E0B;
            --transition-normal: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .dark {
            --bg-primary: #111827;
            --bg-secondary: #1F2937;
            --bg-tertiary: #374151;
            --text-primary: #F9FAFB;
            --text-secondary: #D1D5DB;
            --border-color: #4B5563;
        }

        :root:not(.dark) {
            --bg-primary: #FFFFFF;
            --bg-secondary: #F9FAFB;
            --bg-tertiary: #F3F4F6;
            --text-primary: #1F2937;
            --text-secondary: #6B7280;
            --border-color: #E5E7EB;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            transition: var(--transition-normal);
        }

        .wizard-step {
            transition: var(--transition-normal);
        }

        .container {
            max-width: 1280px;
        }

        .card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transition: var(--transition-normal);
        }

        .card:hover {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            transition: var(--transition-bounce);
            position: relative;
            overflow: hidden;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(0);
        }
        
        .btn-primary.disabled, .btn-primary:disabled {
            background-color: #A5B4FC; /* Lighter indigo for disabled state */
            color: #E0E7FF;
            cursor: not-allowed;
            transform: translateY(0);
        }


        .btn-primary::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .btn-primary:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }

            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }

        .btn-secondary {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            transition: var(--transition-normal);
        }

        .btn-secondary:hover:not(:disabled) {
            filter: brightness(95%);
            transform: translateY(-1px);
        }
         .btn-secondary.disabled, .btn-secondary:disabled {
            background-color: var(--border-color);
            color: var(--text-secondary);
            opacity: 0.7;
            cursor: not-allowed;
            transform: translateY(0);
        }


        .style-card {
            cursor: pointer;
            transition: var(--transition-bounce);
            border: 2px solid transparent;
            transform-origin: center bottom;
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }

        .style-card.selected {
            border-color: var(--primary-color);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .style-card.selected .check-mark {
            opacity: 1;
        }

        .style-card:hover:not(.selected) {
            transform: translateY(-3px);
            border-color: var(--border-color);
        }

        .tab-button {
            position: relative;
            transition: var(--transition-normal);
        }

        .tab-button.active {
            color: var(--primary-color);
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -1px; /* Align with border */
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary-color);
            transform: scaleX(1);
            transition: transform 0.3s ease;
        }

        .tab-button:not(.active)::after {
            content: '';
            position: absolute;
            bottom: -1px; /* Align with border */
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary-color);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .tab-button:hover::after {
            transform: scaleX(1);
        }

        .input-container {
            position: relative;
        }

        .input-container i.input-icon { /* Specific class for input icons */
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            transition: var(--transition-normal);
            pointer-events: none;
        }

        .input-container input:focus + i.input-icon,
        .input-container textarea:focus + i.input-icon {
            color: var(--primary-color);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: var(--border-color);
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background-color: var(--text-secondary);
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: max-content; /* Adjust for content */
            max-width: 250px;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            text-align: center;
            border-radius: 0.5rem;
            padding: 8px 12px;
            position: absolute;
            z-index: 100; /* Ensure tooltip is above other elements */
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
            transform-origin: bottom center;
            font-size: 0.875rem;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(-5px);
        }

        .loading-dot {
            animation: loading 1.4s infinite ease-in-out both;
        }

        .loading-dot:nth-child(2) { animation-delay: 0.2s; }
        .loading-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes loading {
            0%, 80%, 100% { opacity: 0.2; transform: scale(0.8); }
            40% { opacity: 1; transform: scale(1); }
        }

        .color-swatch {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition-bounce);
            border: 2px solid var(--bg-primary);
        }
        .color-swatch:hover { transform: scale(1.2); }
        .color-swatch.selected {
            box-shadow: 0 0 0 2px var(--bg-primary), 0 0 0 4px var(--primary-color);
            transform: scale(1.1);
        }

        .tag {
            background-color: var(--primary-light);
            color: var(--primary-dark);
            transition: var(--transition-normal);
        }
        .tag:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-1px);
        }
        .tag.selected {
            background-color: var(--primary-color);
            color: white;
        }

        .industry-tag {
            transition: var(--transition-normal);
            border: 1px solid transparent;
        }
        .industry-tag.selected {
            background-color: var(--primary-light);
            color: var(--primary-dark);
            border-color: var(--primary-color);
            font-weight: 500;
        }

        .progress-container {
            height: 4px; width: 100%; background-color: var(--bg-tertiary);
            border-radius: 2px; margin-top: 20px; margin-bottom: 30px; position: relative;
        }
        .progress-bar {
            height: 100%; background-color: var(--primary-color);
            border-radius: 2px; transition: width 0.5s ease;
        }
        .progress-step {
            width: 20px; height: 20px; border-radius: 50%; background-color: var(--bg-tertiary);
            border: 2px solid var(--border-color); position: absolute; top: 50%;
            transform: translate(-50%, -50%); display: flex; align-items: center;
            justify-content: center; font-size: 10px; color: var(--text-secondary);
            transition: var(--transition-normal); z-index: 1;
        }
        .progress-step.completed {
            background-color: var(--primary-color); border-color: var(--primary-color); color: white;
        }
        .progress-step.active {
            background-color: var(--bg-primary); border-color: var(--primary-color);
            color: var(--primary-color); transform: translate(-50%, -50%) scale(1.1);
        }

        .flip-in { animation: flip-in 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards; }
        @keyframes flip-in {
            0% { opacity: 0; transform: perspective(400px) rotateX(-90deg); }
            100% { opacity: 1; transform: perspective(400px) rotateX(0); }
        }

        .component-tag {
            display: flex; align-items: center; padding: 10px; border-radius: 6px;
            background-color: var(--bg-tertiary); margin-bottom: 8px;
            transition: var(--transition-normal); cursor: pointer; border: 1px solid var(--border-color);
        }
        .component-tag:hover { background-color: var(--bg-secondary); transform: translateX(5px); }
        .component-tag.selected {
            background-color: var(--primary-light); border-color: var(--primary-color); color: var(--primary-dark);
        }
        .component-icon {
            width: 24px; height: 24px; display: flex; align-items: center;
            justify-content: center; margin-right: 10px; color: var(--primary-color);
        }
        .component-tag.selected .component-icon { color: var(--primary-dark); }

        input, select, textarea {
            transition: var(--transition-normal); border: 1px solid var(--border-color);
            background-color: var(--bg-primary); color: var(--text-primary);
            border-radius: 0.375rem; /* 6px */
            padding: 0.5rem 0.75rem; /* 8px 12px */
        }
        input::placeholder, textarea::placeholder { color: var(--text-secondary); opacity: 0.7; }
        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px var(--primary-light); /* Softer focus ring */
            outline: none;
        }
        textarea.generated-prompt-area {
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            min-height: 120px;
            max-height: 300px;
            white-space: pre-wrap;
            word-wrap: break-word;
            resize: vertical;
        }
        textarea.generated-prompt-area:read-only {
            background-color: var(--bg-secondary); /* Slightly different when readonly */
            cursor: default;
            resize: none;
        }


        .component-preview {
            border: 1px dashed var(--border-color); border-radius: 8px; padding: 15px;
            background-color: var(--bg-tertiary); transition: var(--transition-normal); min-height: 150px;
        }
        .component-preview:hover { border-color: var(--primary-color); background-color: var(--primary-light); }

        .ai-progress-container {
            height: 6px; width: 100%; background-color: var(--bg-tertiary);
            border-radius: 3px; overflow: hidden; margin: 10px 0;
        }
        .ai-progress-bar {
            height: 100%; width: 0%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 3px; transition: width 0.5s ease, background-position 1s ease-in-out;
            animation: progress-anim 2s ease-in-out infinite; background-size: 200% 100%;
        }
        .ai-progress-bar.no-anim { animation: none; background: var(--primary-color); }
        @keyframes progress-anim {
            0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; }
        }

        .copy-animation { animation: pulse 1s ease-in-out; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        .fade-in-out { animation: fadeInOut 1.5s ease-in-out; }
        @keyframes fadeInOut { 0% { opacity: 0; } 20% { opacity: 1; } 80% { opacity: 1; } 100% { opacity: 0; } }

        .modal-backdrop {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* Darker backdrop */
            z-index: 50; display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-backdrop.show { opacity: 1; visibility: visible; }
        .modal {
            background-color: var(--bg-primary); border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            width: 90%; max-width: 600px; /* Increased max-width for settings */
            max-height: 90vh; 
            overflow-y: auto; transform: translateY(20px) scale(0.95);
            transition: transform 0.3s ease-out;
        }
        .modal-backdrop.show .modal { transform: translateY(0) scale(1); }

        .setting-item { transition: background-color 0.2s; }
        .setting-item:hover { background-color: var(--bg-tertiary); }

        /* Keyword Tag Styling */
        .keyword-tag, .custom-keyword-item span {
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 999px; /* pill shape */
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition-normal);
            display: inline-flex; /* For icon alignment */
            align-items: center;
        }
        .keyword-tag:hover, .custom-keyword-item span:hover {
            background-color: var(--primary-light);
            color: var(--primary-dark);
            border-color: var(--primary-color);
            transform: translateY(-1px);
        }
        .keyword-tag i { margin-right: 6px; }
        .custom-keyword-item button {
            background: none; border: none; color: var(--danger-color); margin-left: 8px; cursor: pointer;
            opacity: 0.6; transition: opacity 0.2s;
        }
        .custom-keyword-item button:hover { opacity: 1; }


        /* History Item Styling */
        .history-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            cursor: default; 
            transition: background-color 0.2s;
            font-size: 0.875rem;
        }
        .history-item:last-child { border-bottom: none; }
        .history-item:hover { background-color: var(--bg-tertiary); }
        .history-item .timestamp {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: block;
            margin-top: 4px;
        }
        .history-item-actions button {
            background: none; border: none; color: var(--text-secondary); cursor: pointer; padding: 4px;
        }
        .history-item-actions button:hover { color: var(--primary-color); }

        /* Template Card Styling */
        .template-option-card {
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem; 
            padding: 1rem;
            cursor: pointer;
            transition: var(--transition-bounce);
            text-align: left;
        }
        .template-option-card:hover, .template-option-card.selected { 
            border-color: var(--primary-color);
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 0 0 2px var(--primary-light), 0 6px 12px -2px rgba(99, 102, 241, 0.1); /* Using RGB for primary color */
        }
        .template-option-card h4 {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        .template-option-card p {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Simple tutorial overlay */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .tutorial-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .tutorial-box {
            background-color: var(--bg-primary);
            padding: 2rem;
            border-radius: 1rem;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
        }

        /* Variation Card Styling */
        .variation-card {
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem; /* 8px */
            padding: 0.75rem; /* 12px */
            margin-bottom: 0.5rem; /* 8px */
            position: relative;
        }
        .variation-card textarea {
            width: 100%;
            min-height: 80px;
            background-color: transparent;
            border: none;
            resize: vertical; /* Allow vertical resize */
            padding: 0;
            color: var(--text-primary);
            font-size: 0.875rem; /* Consistent font size */
            line-height: 1.5;
        }
        .variation-card textarea:focus {
            box-shadow: none;
            outline: none;
            border: 1px solid var(--primary-color); /* Indicate focus */
            padding: 0.25rem; /* Add padding on focus for better editing */
            margin: -1px; /* Adjust for border */
        }
        .variation-card textarea:read-only {
            resize: none;
            border: none;
            padding: 0;
            margin: 0;
        }
        .variation-card .variation-actions {
            position: absolute;
            top: 0.5rem; /* 8px */
            right: 0.5rem; /* 8px */
            display: flex;
            gap: 0.25rem; /* 4px */
        }
        .variation-card .variation-actions button {
            padding: 0.25rem 0.5rem; /* 4px 8px */
            font-size: 0.75rem; /* 12px */
            background-color: var(--primary-light);
            color: var(--primary-dark);
            border-radius: 0.25rem; /* 4px */
            transition: var(--transition-normal);
            border: none;
        }
        .variation-card .variation-actions button:hover {
            background-color: var(--primary-color);
            color: white;
        }


        /* Settings Tabs */
        .settings-tabs {
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem; /* Add margin for content below */
        }
        .settings-tab-content {
            display: none;
        }
        .settings-tab-content.active {
            display: block;
        }

    </style>
</head>

<body>
    <div class="container mx-auto px-4 py-6">
        <header class="flex justify-between items-center mb-8">
            <div class="flex items-center space-x-2">
                <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center text-white" aria-hidden="true">
                    <i class="fas fa-wand-magic-sparkles text-xl"></i>
                </div>
                <h1 class="text-2xl md:text-3xl font-bold" data-i18n="appTitle">AI UI <span class="text-indigo-500">提示词生成器</span> Pro</h1>
            </div>
            <div class="flex items-center space-x-3">
                <button id="randomSurpriseBtn" class="p-2 rounded-full bg-yellow-100 text-yellow-600 dark:bg-yellow-700 dark:text-yellow-300 hover:bg-yellow-200 dark:hover:bg-yellow-600 transition-colors tooltip" aria-label="随机灵感">
                    <i class="fas fa-random" aria-hidden="true"></i>
                    <span class="tooltip-text" data-i18n="randomSurpriseTooltip">随机灵感</span>
                </button>
                <button id="themeToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors tooltip" aria-label="切换主题">
                    <i class="fas fa-moon dark:hidden" aria-hidden="true"></i>
                    <i class="fas fa-sun hidden dark:block" aria-hidden="true"></i>
                    <span class="tooltip-text" data-i18n="themeToggleTooltip">切换主题</span>
                </button>
                <div class="relative">
                    <button id="languageSelector" class="px-3 py-2 rounded-md bg-gray-100 dark:bg-gray-700 flex items-center space-x-1 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors tooltip" aria-label="选择界面语言" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-globe text-sm" aria-hidden="true"></i>
                        <span id="currentDisplayLang">中文</span>
                        <i class="fas fa-chevron-down text-xs ml-1" aria-hidden="true"></i>
                        <span class="tooltip-text" data-i18n="languageSelectorTooltip">选择界面语言</span>
                    </button>
                    <div id="languageDropdown" class="absolute right-0 mt-2 w-32 bg-white dark:bg-gray-800 rounded-md shadow-lg z-20 hidden py-1" role="menu">
                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700" data-lang="zh-CN" role="menuitem">简体中文</a>
                        <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-700" data-lang="en-US" role="menuitem">English</a>
                    </div>
                </div>
                <button id="settingsButton" class="p-2 rounded-full bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors tooltip" aria-label="设置">
                    <i class="fas fa-cog" aria-hidden="true"></i>
                    <span class="tooltip-text" data-i18n="settingsTooltip">设置</span>
                </button>
                 <button id="showHelpButton" class="p-2 rounded-full bg-blue-100 text-blue-600 dark:bg-blue-900 dark:text-blue-300 hover:bg-blue-200 dark:hover:bg-blue-700 transition-colors tooltip" aria-label="帮助/教程">
                    <i class="fas fa-question-circle" aria-hidden="true"></i>
                    <span class="tooltip-text" data-i18n="helpTooltip">帮助/教程</span>
                </button>
            </div>
        </header>

        <!-- Progress Bar -->
        <div class="progress-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="生成步骤进度">
            <div id="progressBar" class="progress-bar" style="width: 0%"></div>
            <div class="progress-step active" style="left: 0%" id="stepIndicator1" aria-label="步骤1：设计目的">1</div>
            <div class="progress-step" style="left: 33.33%" id="stepIndicator2" aria-label="步骤2：风格选择">2</div>
            <div class="progress-step" style="left: 66.66%" id="stepIndicator3" aria-label="步骤3：颜色和组件">3</div>
            <div class="progress-step" style="left: 100%" id="stepIndicator4" aria-label="步骤4：生成提示词">4</div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- 左侧栏 - 输入选项 -->
            <main class="lg:col-span-2">
                <div class="card p-6 mb-6">
                    <div class="wizard-container">
                        <!-- 步骤 1: 设计目的 -->
                        <section class="wizard-step" id="wizardStep1" aria-labelledby="step1TitleHeading">
                            <h2 id="step1TitleHeading" class="text-2xl font-bold mb-4 flex items-center">
                                <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center mr-3" aria-hidden="true">1</div>
                                <span data-i18n="step1Title">设计目的</span>
                            </h2>
                            <p class="text-gray-600 dark:text-gray-300 mb-6" data-i18n="step1Desc">首先选择您的 UI 设计目的和行业，这将帮助我们为您生成更精准的提示词。</p>

                            <h3 class="font-medium mb-3" data-i18n="step1PurposeQuestion">您的 UI 用于什么目的？</h3>
                            <div role="group" aria-labelledby="step1PurposeQuestion" class="p-3 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-6 custom-scrollbar" style="max-height: 300px; overflow-y: auto;">
                                <div class="purpose-card style-card p-4 rounded-xl shadow-sm text-center relative" data-purpose="website" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <div class="h-12 flex items-center justify-center mb-3"><i class="fas fa-globe text-3xl text-blue-500" aria-hidden="true"></i></div>
                                    <p class="font-medium" data-i18n="purposeWebsite">网站</p><p class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-i18n="purposeWebsiteDesc">公司官网、产品展示等</p>
                                </div>
                                <div class="purpose-card style-card p-4 rounded-xl shadow-sm text-center relative" data-purpose="mobile-app" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <div class="h-12 flex items-center justify-center mb-3"><i class="fas fa-mobile-alt text-3xl text-green-500" aria-hidden="true"></i></div>
                                    <p class="font-medium" data-i18n="purposeMobileApp">移动应用</p><p class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-i18n="purposeMobileAppDesc">iOS、Android 等平台</p>
                                </div>
                                <div class="purpose-card style-card p-4 rounded-xl shadow-sm text-center relative" data-purpose="dashboard" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <div class="h-12 flex items-center justify-center mb-3"><i class="fas fa-chart-line text-3xl text-purple-500" aria-hidden="true"></i></div>
                                    <p class="font-medium" data-i18n="purposeDashboard">仪表盘</p><p class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-i18n="purposeDashboardDesc">数据分析、监控等</p>
                                </div>
                                <div class="purpose-card style-card p-4 rounded-xl shadow-sm text-center relative" data-purpose="ecommerce" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <div class="h-12 flex items-center justify-center mb-3"><i class="fas fa-shopping-cart text-3xl text-orange-500" aria-hidden="true"></i></div>
                                    <p class="font-medium" data-i18n="purposeEcommerce">电子商务</p><p class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-i18n="purposeEcommerceDesc">在线商店、购物平台等</p>
                                </div>
                                <div class="purpose-card style-card p-4 rounded-xl shadow-sm text-center relative" data-purpose="marketing" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <div class="h-12 flex items-center justify-center mb-3"><i class="fas fa-bullhorn text-3xl text-pink-500" aria-hidden="true"></i></div>
                                    <p class="font-medium" data-i18n="purposeMarketing">营销推广</p><p class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-i18n="purposeMarketingDesc">广告页面、活动推广等</p>
                                </div>
                                <div class="purpose-card style-card p-4 rounded-xl shadow-sm text-center relative" data-purpose="social-media" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <div class="h-12 flex items-center justify-center mb-3"><i class="fas fa-users text-3xl text-blue-400" aria-hidden="true"></i></div>
                                    <p class="font-medium" data-i18n="purposeSocial">社交媒体</p><p class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-i18n="purposeSocialDesc">社交平台、社区应用等</p>
                                </div>
                                <div class="purpose-card style-card p-4 rounded-xl shadow-sm text-center relative" data-purpose="education" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <div class="h-12 flex items-center justify-center mb-3"><i class="fas fa-graduation-cap text-3xl text-yellow-600" aria-hidden="true"></i></div>
                                    <p class="font-medium" data-i18n="purposeEducation">教育平台</p><p class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-i18n="purposeEducationDesc">学习系统、在线课堂等</p>
                                </div>
                                <div class="purpose-card style-card p-4 rounded-xl shadow-sm text-center relative" data-purpose="productivity" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <div class="h-12 flex items-center justify-center mb-3"><i class="fas fa-tasks text-3xl text-green-600" aria-hidden="true"></i></div>
                                    <p class="font-medium" data-i18n="purposeProductivity">生产力工具</p><p class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-i18n="purposeProductivityDesc">任务管理、协作工具等</p>
                                </div>
                                <div class="purpose-card style-card p-4 rounded-xl shadow-sm text-center relative" data-purpose="entertainment" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <div class="h-12 flex items-center justify-center mb-3"><i class="fas fa-film text-3xl text-red-600" aria-hidden="true"></i></div>
                                    <p class="font-medium" data-i18n="purposeEntertainment">娱乐应用</p><p class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-i18n="purposeEntertainmentDesc">视频、游戏、音乐等</p>
                                </div>
                                <div class="purpose-card style-card p-4 rounded-xl shadow-sm text-center relative" data-purpose="health" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <div class="h-12 flex items-center justify-center mb-3"><i class="fas fa-heartbeat text-3xl text-red-500" aria-hidden="true"></i></div>
                                    <p class="font-medium" data-i18n="purposeHealth">健康应用</p><p class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-i18n="purposeHealthDesc">健身、医疗监测等</p>
                                </div>
                                <div class="purpose-card style-card p-4 rounded-xl shadow-sm text-center relative" data-purpose="travel" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <div class="h-12 flex items-center justify-center mb-3"><i class="fas fa-plane text-3xl text-cyan-500" aria-hidden="true"></i></div>
                                    <p class="font-medium" data-i18n="purposeTravel">旅行服务</p><p class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-i18n="purposeTravelDesc">旅游规划、预订服务等</p>
                                </div>
                                <div class="purpose-card style-card p-4 rounded-xl shadow-sm text-center relative" data-purpose="finance" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <div class="h-12 flex items-center justify-center mb-3"><i class="fas fa-chart-pie text-3xl text-green-500" aria-hidden="true"></i></div>
                                    <p class="font-medium" data-i18n="purposeFinance">金融工具</p><p class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-i18n="purposeFinanceDesc">投资分析、预算管理等</p>
                                </div>
                                <div class="purpose-card style-card p-4 rounded-xl shadow-sm text-center relative" data-purpose="other" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <div class="h-12 flex items-center justify-center mb-3"><i class="fas fa-ellipsis-h text-3xl text-gray-500" aria-hidden="true"></i></div>
                                    <p class="font-medium" data-i18n="purposeOther">其他</p><p class="text-xs text-gray-500 dark:text-gray-400 mt-1" data-i18n="purposeOtherDesc">自定义目的</p>
                                </div>
                            </div>

                            <h3 class="font-medium mb-3" id="step1IndustryQuestionHeading" data-i18n="step1IndustryQuestion">选择行业领域</h3>
                            <div role="group" aria-labelledby="step1IndustryQuestionHeading" class="flex flex-wrap gap-2 mb-6 max-h-40 custom-scrollbar overflow-y-auto pb-2">
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="tech" data-i18n="industryTech" tabindex="0" role="button">科技</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="finance" data-i18n="industryFinance" tabindex="0" role="button">金融</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="healthcare" data-i18n="industryHealthcare" tabindex="0" role="button">医疗健康</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="education" data-i18n="industryEducation" tabindex="0" role="button">教育</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="entertainment" data-i18n="industryEntertainment" tabindex="0" role="button">娱乐</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="food" data-i18n="industryFood" tabindex="0" role="button">餐饮</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="travel" data-i18n="industryTravel" tabindex="0" role="button">旅游</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="real-estate" data-i18n="industryRealEstate" tabindex="0" role="button">房地产</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="fashion" data-i18n="industryFashion" tabindex="0" role="button">时尚</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="retail" data-i18n="industryRetail" tabindex="0" role="button">零售</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="manufacturing" data-i18n="industryManufacturing" tabindex="0" role="button">制造业</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="transportation" data-i18n="industryTransportation" tabindex="0" role="button">交通运输</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="energy" data-i18n="industryEnergy" tabindex="0" role="button">能源</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="agriculture" data-i18n="industryAgriculture" tabindex="0" role="button">农业</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="construction" data-i18n="industryConstruction" tabindex="0" role="button">建筑</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="media" data-i18n="industryMedia" tabindex="0" role="button">媒体</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="sports" data-i18n="industrySports" tabindex="0" role="button">体育</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="gaming" data-i18n="industryGaming" tabindex="0" role="button">游戏</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="automotive" data-i18n="industryAutomotive" tabindex="0" role="button">汽车</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="legal" data-i18n="industryLegal" tabindex="0" role="button">法律</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="government" data-i18n="industryGovernment" tabindex="0" role="button">政府</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="nonprofit" data-i18n="industryNonprofit" tabindex="0" role="button">非营利组织</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="art" data-i18n="industryArt" tabindex="0" role="button">艺术文化</span>
                                <span class="industry-tag tag px-3 py-2 rounded-full cursor-pointer" data-industry="other" data-i18n="industryOther" tabindex="0" role="button">其他</span>
                            </div>

                            <div class="flex justify-end">
                                <button id="nextStep1" class="btn-primary px-6 py-3 rounded-md" data-i18n="nextButton">下一步</button>
                            </div>
                        </section>

                        <!-- 步骤 2: 风格选择 -->
                        <section class="wizard-step hidden" id="wizardStep2" aria-labelledby="step2TitleHeading">
                            <h2 id="step2TitleHeading" class="text-2xl font-bold mb-4 flex items-center">
                                <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center mr-3" aria-hidden="true">2</div>
                                <span data-i18n="step2Title">风格选择</span>
                            </h2>
                            <p class="text-gray-600 dark:text-gray-300 mb-6" data-i18n="step2Desc">选择您喜欢的 UI 风格，我们将据此生成更符合您审美的提示词。</p>
                            
                            <h3 class="font-medium mb-3" id="step2TemplateQuestionHeading" data-i18n="step2TemplateQuestion">或选择一个设计模板作为起点？ (可选)</h3>
                            <div id="templateSelectionContainer" role="group" aria-labelledby="step2TemplateQuestionHeading" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 max-h-60 custom-scrollbar overflow-y-auto pr-2">
                                <!-- Templates will be populated by JS -->
                            </div>


                            <h3 class="font-medium mb-3" id="step2StyleQuestionHeading" data-i18n="step2StyleQuestion">选择设计风格</h3>
                            <div role="group" aria-labelledby="step2StyleQuestionHeading" class="p-3 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-6 max-h-96 overflow-y-auto custom-scrollbar pr-2">
                                <div class="style-card p-4 rounded-xl shadow-sm relative" data-style="简约" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <img src="https://images.unsplash.com/photo-1513519245088-0e12902e5a38?ixlib=rb-1.2.1&auto=format&fit=crop&w=200&h=150&q=80" alt="简约风格" class="rounded-md mb-3 h-24 object-cover w-full">
                                    <p class="font-medium text-center" data-i18n="styleMinimalist">简约</p>
                                </div>
                                <div class="style-card p-4 rounded-xl shadow-sm relative" data-style="现代" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <img src="https://images.unsplash.com/photo-1487958449943-2429e8be8625?ixlib=rb-1.2.1&auto=format&fit=crop&w=200&h=150&q=80" alt="现代风格" class="rounded-md mb-3 h-24 object-cover w-full">
                                    <p class="font-medium text-center" data-i18n="styleModern">现代</p>
                                </div>
                                <div class="style-card p-4 rounded-xl shadow-sm relative" data-style="复古" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <img src="https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?w=200&h=150" alt="复古风格" class="rounded-md mb-3 h-24 object-cover w-full">
                                    <p class="font-medium text-center" data-i18n="styleRetro">复古</p>
                                </div>
                                <div class="style-card p-4 rounded-xl shadow-sm relative" data-style="卡通" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <img src="https://images.unsplash.com/photo-1619950835688-1bddaffce4a0?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTZ8fCVFNSU4RCVBMSVFOSU4MCU5QSVFNyVCRCU5MSVFNyVBQiU5OXxlbnwwfHwwfHx8MA%3D%3D" alt="卡通风格" class="rounded-md mb-3 h-24 object-cover w-full">
                                    <p class="font-medium text-center" data-i18n="styleCartoon">卡通</p>
                                </div>
                                <div class="style-card p-4 rounded-xl shadow-sm relative" data-style="科技" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <img src="https://images.unsplash.com/photo-1451187580459-43490279c0fa?ixlib=rb-1.2.1&auto=format&fit=crop&w=200&h=150&q=80" alt="科技风格" class="rounded-md mb-3 h-24 object-cover w-full">
                                    <p class="font-medium text-center" data-i18n="styleTech">科技</p>
                                </div>
                                <div class="style-card p-4 rounded-xl shadow-sm relative" data-style="手绘" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <img src="https://images.unsplash.com/photo-1579783902614-a3fb3927b6a5?ixlib=rb-1.2.1&auto=format&fit=crop&w=200&h=150&q=80" alt="手绘风格" class="rounded-md mb-3 h-24 object-cover w-full">
                                    <p class="font-medium text-center" data-i18n="styleHandDrawn">手绘</p>
                                </div>
                                <div class="style-card p-4 rounded-xl shadow-sm relative" data-style="极简" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <img src="https://images.unsplash.com/photo-1499951360447-b19be8fe80f5?ixlib=rb-1.2.1&auto=format&fit=crop&w=200&h=150&q=80" alt="极简风格" class="rounded-md mb-3 h-24 object-cover w-full">
                                    <p class="font-medium text-center" data-i18n="styleUltraMinimalist">极简</p>
                                </div>
                                <div class="style-card p-4 rounded-xl shadow-sm relative" data-style="扁平化" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <img src="https://images.unsplash.com/photo-1545235617-9465d2a55698?ixlib=rb-1.2.1&auto=format&fit=crop&w=200&h=150&q=80" alt="扁平化风格" class="rounded-md mb-3 h-24 object-cover w-full">
                                    <p class="font-medium text-center" data-i18n="styleFlat">扁平化</p>
                                </div>
                                <div class="style-card p-4 rounded-xl shadow-sm relative" data-style="拟物化" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <img src="https://images.unsplash.com/photo-1611162617213-7d7a39e9b1d7?ixlib=rb-1.2.1&auto=format&fit=crop&w=200&h=150&q=80" alt="拟物化风格" class="rounded-md mb-3 h-24 object-cover w-full">
                                    <p class="font-medium text-center" data-i18n="styleSkeuomorphic">拟物化</p>
                                </div>
                                <div class="style-card p-4 rounded-xl shadow-sm relative" data-style="新拟物" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <img src="https://images.unsplash.com/photo-1550751827-4bd374c3f58b?ixlib=rb-1.2.1&auto=format&fit=crop&w=200&h=150&q=80" alt="新拟物风格" class="rounded-md mb-3 h-24 object-cover w-full">
                                    <p class="font-medium text-center" data-i18n="styleNeumorphic">新拟物</p>
                                </div>
                                <div class="style-card p-4 rounded-xl shadow-sm relative" data-style="未来主义" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <img src="https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-1.2.1&auto=format&fit=crop&w=200&h=150&q=80" alt="未来主义风格" class="rounded-md mb-3 h-24 object-cover w-full">
                                    <p class="font-medium text-center" data-i18n="styleFuturistic">未来主义</p>
                                </div>
                                <div class="style-card p-4 rounded-xl shadow-sm relative" data-style="水墨" tabindex="0" role="button">
                                    <div class="absolute top-0 right-0 w-5 h-5 rounded-full bg-indigo-500 text-white transform translate-x-1 -translate-y-1 opacity-0 check-mark flex items-center justify-center" aria-hidden="true"><i class="fas fa-check text-xs"></i></div>
                                    <img src="https://images.unsplash.com/photo-1658402995914-22a4ba7e1a94?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTh8fCVFNiVCMCVCNCVFNSVBMiVBOCVFOSVBMyU4RSVFNiVBMCVCQ3xlbnwwfHwwfHx8MA%3D%3D" alt="水墨风格" class="rounded-md mb-3 h-24 object-cover w-full">
                                    <p class="font-medium text-center" data-i18n="styleInkWash">水墨</p>
                                </div>
                            </div>

                            <div class="flex justify-between">
                                <button id="prevStep2" class="btn-secondary px-6 py-3 rounded-md" data-i18n="prevButton">上一步</button>
                                <button id="nextStep2" class="btn-primary px-6 py-3 rounded-md" data-i18n="nextButton">下一步</button>
                            </div>
                        </section>

                        <!-- 步骤 3: 颜色和组件 -->
                        <section class="wizard-step hidden" id="wizardStep3" aria-labelledby="step3TitleHeading">
                            <h2 id="step3TitleHeading" class="text-2xl font-bold mb-4 flex items-center">
                                <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center mr-3" aria-hidden="true">3</div>
                                <span data-i18n="step3Title">颜色和组件</span>
                            </h2>
                            <p class="text-gray-600 dark:text-gray-300 mb-6" data-i18n="step3Desc">选择您喜欢的主题色和需要的 UI 组件，这将帮助我们更好地生成提示词。</p>

                            <h3 class="font-medium mb-3" id="step3ColorQuestionHeading" data-i18n="step3ColorQuestion">主题颜色</h3>
                            <div role="group" aria-labelledby="step3ColorQuestionHeading" class="flex flex-wrap items-center gap-3 mb-4">
                                <div class="color-swatch" style="background-color:#F44336;" data-color="#F44336" aria-label="选择红色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#E91E63;" data-color="#E91E63" aria-label="选择粉色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#9C27B0;" data-color="#9C27B0" aria-label="选择紫色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#673AB7;" data-color="#673AB7" aria-label="选择深紫色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#3F51B5;" data-color="#3F51B5" aria-label="选择靛蓝色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#2196F3;" data-color="#2196F3" aria-label="选择蓝色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#03A9F4;" data-color="#03A9F4" aria-label="选择浅蓝色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#00BCD4;" data-color="#00BCD4" aria-label="选择青色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#009688;" data-color="#009688" aria-label="选择蓝绿色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#4CAF50;" data-color="#4CAF50" aria-label="选择绿色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#8BC34A;" data-color="#8BC34A" aria-label="选择浅绿色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#CDDC39;" data-color="#CDDC39" aria-label="选择黄绿色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#FFEB3B;" data-color="#FFEB3B" aria-label="选择黄色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#FFC107;" data-color="#FFC107" aria-label="选择琥珀色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#FF9800;" data-color="#FF9800" aria-label="选择橙色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#FF5722;" data-color="#FF5722" aria-label="选择深橙色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#795548;" data-color="#795548" aria-label="选择棕色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#9E9E9E;" data-color="#9E9E9E" aria-label="选择灰色" tabindex="0" role="button"></div>
                                <div class="color-swatch" style="background-color:#607D8B;" data-color="#607D8B" aria-label="选择蓝灰色" tabindex="0" role="button"></div>
                            </div>
                            <div class="custom-color-container mb-6 flex items-center gap-2">
                                <div id="customColorPreview" class="custom-color-preview w-10 h-10 rounded-full border-2" style="background-color:#6366F1;" aria-label="自定义颜色预览"></div>
                                <input type="text" id="customColorInput" class="custom-color-input flex-grow p-2 border rounded" placeholder="#RRGGBB or name" value="#6366F1" aria-label="自定义颜色输入">
                                <button id="applyCustomColor" class="btn-secondary px-4 py-2 rounded-md" data-i18n="applyButton">应用</button>
                            </div>

                            <h3 class="font-medium mb-3" id="step3ComponentQuestionHeading" data-i18n="step3ComponentQuestion">选择需要的 UI 组件</h3>
                            <div class="component-search flex gap-2 mb-3">
                                <input type="text" id="componentSearch" data-i18n-placeholder="searchComponentsPlaceholder" placeholder="搜索组件..." class="flex-grow p-2 border rounded" aria-label="搜索组件">
                                <button id="clearSearch" class="p-2 bg-gray-200 dark:bg-gray-700 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600" aria-label="清空搜索"><i class="fas fa-times" aria-hidden="true"></i></button>
                            </div>
                            <div role="tablist" aria-label="组件分类" class="component-categories flex flex-wrap gap-2 mb-3">
                                <span class="category-pill tag active" data-category="all" data-i18n="categoryAll" role="tab" aria-selected="true" tabindex="0">全部</span>
                                <span class="category-pill tag" data-category="navigation" data-i18n="categoryNav" role="tab" aria-selected="false" tabindex="0">导航类</span>
                                <span class="category-pill tag" data-category="content" data-i18n="categoryContent" role="tab" aria-selected="false" tabindex="0">内容类</span>
                                <span class="category-pill tag" data-category="interaction" data-i18n="categoryInteraction" role="tab" aria-selected="false" tabindex="0">交互类</span>
                                <span class="category-pill tag" data-category="data" data-i18n="categoryData" role="tab" aria-selected="false" tabindex="0">数据类</span>
                                <span class="category-pill tag" data-category="mobile" data-i18n="categoryMobile" role="tab" aria-selected="false" tabindex="0">移动端</span>
                                <span class="category-pill tag" data-category="dialog" data-i18n="categoryDialog" role="tab" aria-selected="false" tabindex="0">弹窗类</span>
                            </div>
                            <div id="componentContainer" class="max-h-80 overflow-y-auto custom-scrollbar pr-2" role="group" aria-labelledby="step3ComponentQuestionHeading">
                                <div class="component-section" data-category="navigation" role="tabpanel">
                                    <div class="component-section-title font-semibold my-2"><i class="fas fa-bars text-indigo-500 mr-1" aria-hidden="true"></i> <span data-i18n="categoryNav">导航类组件</span></div>
                                    <div class="component-group">
                                        <div class="component-tag" data-component-id="navbar" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-bars" aria-hidden="true"></i></span> <span data-i18n="componentNavbar">导航栏</span></div>
                                        <div class="component-tag" data-component-id="searchbox" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-search" aria-hidden="true"></i></span> <span data-i18n="componentSearchBox">搜索框</span></div>
                                        <div class="component-tag" data-component-id="breadcrumbs" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-bread-slice" aria-hidden="true"></i></span> <span data-i18n="componentBreadcrumbs">面包屑导航</span></div>
                                        <div class="component-tag" data-component-id="sidenav" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-list-ul" aria-hidden="true"></i></span> <span data-i18n="componentSidenav">侧边导航</span></div>
                                        <div class="component-tag" data-component-id="navcard" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-th-large" aria-hidden="true"></i></span> <span data-i18n="componentNavCard">导航卡片</span></div>
                                        <div class="component-tag" data-component-id="backtotop" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-arrow-up" aria-hidden="true"></i></span> <span data-i18n="componentBackToTop">返回顶部</span></div>
                                    </div>
                                </div>
                                <div class="component-section" data-category="content" role="tabpanel">
                                    <div class="component-section-title font-semibold my-2"><i class="fas fa-file-alt text-indigo-500 mr-1" aria-hidden="true"></i> <span data-i18n="categoryContent">内容类组件</span></div>
                                    <div class="component-group">
                                        <div class="component-tag" data-component-id="hero" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-star" aria-hidden="true"></i></span> <span data-i18n="componentHero">Hero区域</span></div>
                                        <div class="component-tag" data-component-id="contentblock" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-columns" aria-hidden="true"></i></span> <span data-i18n="componentContentBlock">内容区块</span></div>
                                        <div class="component-tag" data-component-id="gallery" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-images" aria-hidden="true"></i></span> <span data-i18n="componentGallery">图片画廊</span></div>
                                        <div class="component-tag" data-component-id="carousel" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="far fa-image" aria-hidden="true"></i></span> <span data-i18n="componentCarousel">轮播图</span></div>
                                        <div class="component-tag" data-component-id="videoplayer" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-video" aria-hidden="true"></i></span> <span data-i18n="componentVideoPlayer">视频播放器</span></div>
                                        <div class="component-tag" data-component-id="testimonials" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-quote-left" aria-hidden="true"></i></span> <span data-i18n="componentTestimonials">客户评价</span></div>
                                        <div class="component-tag" data-component-id="team" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-users" aria-hidden="true"></i></span> <span data-i18n="componentTeam">团队成员</span></div>
                                        <div class="component-tag" data-component-id="productdisplay" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-shopping-bag" aria-hidden="true"></i></span> <span data-i18n="componentProductDisplay">产品展示</span></div>
                                        <div class="component-tag" data-component-id="blogpost" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-file-alt" aria-hidden="true"></i></span> <span data-i18n="componentBlogPost">博客文章</span></div>
                                        <div class="component-tag" data-component-id="faq" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-question-circle" aria-hidden="true"></i></span> <span data-i18n="componentFaq">FAQ折叠</span></div>
                                        <div class="component-tag" data-component-id="codedisplay" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-code" aria-hidden="true"></i></span> <span data-i18n="componentCodeDisplay">代码展示</span></div>
                                    </div>
                                </div>
                                <div class="component-section" data-category="interaction" role="tabpanel">
                                    <div class="component-section-title font-semibold my-2"><i class="fas fa-mouse-pointer text-indigo-500 mr-1" aria-hidden="true"></i> <span data-i18n="categoryInteraction">交互类组件</span></div>
                                    <div class="component-group">
                                        <div class="component-tag" data-component-id="contactform" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-envelope" aria-hidden="true"></i></span> <span data-i18n="componentContactForm">联系表单</span></div>
                                        <div class="component-tag" data-component-id="comments" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-comments" aria-hidden="true"></i></span> <span data-i18n="componentComments">评论区</span></div>
                                        <div class="component-tag" data-component-id="socialshare" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-share-alt" aria-hidden="true"></i></span> <span data-i18n="componentSocialShare">社交分享</span></div>
                                        <div class="component-tag" data-component-id="fab" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-bolt" aria-hidden="true"></i></span> <span data-i18n="componentFab">悬浮按钮</span></div>
                                        <div class="component-tag" data-component-id="subscribe" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-rss" aria-hidden="true"></i></span> <span data-i18n="componentSubscribe">订阅组件</span></div>
                                        <div class="component-tag" data-component-id="shoppingcart" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-shopping-cart" aria-hidden="true"></i></span> <span data-i18n="componentShoppingCart">购物车</span></div>
                                        <div class="component-tag" data-component-id="filters" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-filter" aria-hidden="true"></i></span> <span data-i18n="componentFilters">筛选器</span></div>
                                        <div class="component-tag" data-component-id="langswitcher" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-language" aria-hidden="true"></i></span> <span data-i18n="componentLangSwitcher">语言切换</span></div>
                                        <div class="component-tag" data-component-id="cookieconsent" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-cookie-bite" aria-hidden="true"></i></span> <span data-i18n="componentCookieConsent">Cookie提示</span></div>
                                    </div>
                                </div>
                                 <div class="component-section" data-category="data" role="tabpanel">
                                    <div class="component-section-title font-semibold my-2"><i class="fas fa-chart-line text-indigo-500 mr-1" aria-hidden="true"></i> <span data-i18n="categoryData">数据类组件</span></div>
                                    <div class="component-group">
                                        <div class="component-tag" data-component-id="datatable" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-table" aria-hidden="true"></i></span> <span data-i18n="componentDataTable">数据表格</span></div>
                                        <div class="component-tag" data-component-id="charts" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-chart-pie" aria-hidden="true"></i></span> <span data-i18n="componentCharts">图表</span></div>
                                        <div class="component-tag" data-component-id="map" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-map-marker-alt" aria-hidden="true"></i></span> <span data-i18n="componentMap">地图集成</span></div>
                                        <div class="component-tag" data-component-id="calendar" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-calendar-alt" aria-hidden="true"></i></span> <span data-i18n="componentCalendar">活动日历</span></div>
                                        <div class="component-tag" data-component-id="statscard" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-chart-bar" aria-hidden="true"></i></span> <span data-i18n="componentStatsCard">统计卡片</span></div>
                                        <div class="component-tag" data-component-id="tagcloud" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-tags" aria-hidden="true"></i></span> <span data-i18n="componentTagCloud">标签云</span></div>
                                        <div class="component-tag" data-component-id="progressindicator" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-check-circle" aria-hidden="true"></i></span> <span data-i18n="componentProgressIndicator">进度指示</span></div>
                                    </div>
                                </div>
                                <div class="component-section" data-category="mobile" role="tabpanel">
                                    <div class="component-section-title font-semibold my-2"><i class="fas fa-mobile-alt text-indigo-500 mr-1" aria-hidden="true"></i> <span data-i18n="categoryMobile">移动端专用组件</span></div>
                                    <div class="component-group">
                                        <div class="component-tag" data-component-id="bottomnav" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-mobile-screen-button" aria-hidden="true"></i></span> <span data-i18n="componentBottomNav">底部导航栏</span></div>
                                        <div class="component-tag" data-component-id="mobilepayment" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-hand-holding-usd" aria-hidden="true"></i></span> <span data-i18n="componentMobilePayment">移动支付</span></div>
                                        <div class="component-tag" data-component-id="biometric" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-fingerprint" aria-hidden="true"></i></span> <span data-i18n="componentBiometric">生物识别</span></div>
                                        <div class="component-tag" data-component-id="swipeactions" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-swipe" aria-hidden="true"></i></span> <span data-i18n="componentSwipeActions">滑动操作</span></div>
                                        <div class="component-tag" data-component-id="pulltorefresh" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-arrows-alt-v" aria-hidden="true"></i></span> <span data-i18n="componentPullToRefresh">下拉刷新</span></div>
                                        <div class="component-tag" data-component-id="geolocation" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-location-arrow" aria-hidden="true"></i></span> <span data-i18n="componentGeolocation">地理定位</span></div>
                                        <div class="component-tag" data-component-id="qrcode" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-qrcode" aria-hidden="true"></i></span> <span data-i18n="componentQrcode">扫码功能</span></div>
                                        <div class="component-tag" data-component-id="gestures" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-comment-dots" aria-hidden="true"></i></span> <span data-i18n="componentGestures">手势提示</span></div>
                                        <div class="component-tag" data-component-id="responsivemenu" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-mobile-alt" aria-hidden="true"></i></span> <span data-i18n="componentResponsiveMenu">响应式菜单</span></div>
                                    </div>
                                </div>
                                <div class="component-section" data-category="dialog" role="tabpanel">
                                    <div class="component-section-title font-semibold my-2"><i class="fas fa-window-maximize text-indigo-500 mr-1" aria-hidden="true"></i> <span data-i18n="categoryDialog">弹窗类组件</span></div>
                                    <div class="component-group">
                                        <div class="component-tag" data-component-id="modal" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-window-maximize" aria-hidden="true"></i></span> <span data-i18n="componentModal">模态弹窗</span></div>
                                        <div class="component-tag" data-component-id="alertdialog" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-exclamation-circle" aria-hidden="true"></i></span> <span data-i18n="componentAlertDialog">警告弹窗</span></div>
                                        <div class="component-tag" data-component-id="confirmdialog" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-check-circle" aria-hidden="true"></i></span> <span data-i18n="componentConfirmDialog">确认弹窗</span></div>
                                        <div class="component-tag" data-component-id="notification" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-bell" aria-hidden="true"></i></span> <span data-i18n="componentNotification">通知弹窗</span></div>
                                        <div class="component-tag" data-component-id="logindialog" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-sign-in-alt" aria-hidden="true"></i></span> <span data-i18n="componentLoginDialog">登录弹窗</span></div>
                                        <div class="component-tag" data-component-id="quickbuy" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-shopping-cart" aria-hidden="true"></i></span> <span data-i18n="componentQuickBuy">快速购买</span></div>
                                        <div class="component-tag" data-component-id="sharedialog" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-share-square" aria-hidden="true"></i></span> <span data-i18n="componentShareDialog">分享弹窗</span></div>
                                        <div class="component-tag" data-component-id="imageviewer" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-image" aria-hidden="true"></i></span> <span data-i18n="componentImageViewer">图片查看</span></div>
                                        <div class="component-tag" data-component-id="datepicker" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-calendar-day" aria-hidden="true"></i></span> <span data-i18n="componentDatePicker">日期选择</span></div>
                                        <div class="component-tag" data-component-id="filterdialog" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-filter" aria-hidden="true"></i></span> <span data-i18n="componentFilterDialog">筛选弹窗</span></div>
                                        <div class="component-tag" data-component-id="fullscreensearch" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-search-location" aria-hidden="true"></i></span> <span data-i18n="componentFullscreenSearch">全屏搜索</span></div>
                                        <div class="component-tag" data-component-id="loadingdialog" tabindex="0" role="checkbox" aria-checked="false"><span class="component-icon"><i class="fas fa-hourglass-half" aria-hidden="true"></i></span> <span data-i18n="componentLoadingDialog">加载弹窗</span></div>
                                    </div>
                                </div>
                            </div>

                            <div class="flex justify-between mt-6">
                                <button id="prevStep3" class="btn-secondary px-6 py-3 rounded-md" data-i18n="prevButton">上一步</button>
                                <button id="nextStep3" class="btn-primary px-6 py-3 rounded-md" data-i18n="nextButton">下一步</button>
                            </div>
                        </section>

                        <!-- 步骤 4: 生成提示词 -->
                        <section class="wizard-step hidden" id="wizardStep4" aria-labelledby="step4TitleHeading">
                            <h2 id="step4TitleHeading" class="text-2xl font-bold mb-4 flex items-center">
                                <div class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center mr-3" aria-hidden="true">4</div>
                                <span data-i18n="step4Title">生成提示词</span>
                            </h2>
                            <p class="text-gray-600 dark:text-gray-300 mb-6" data-i18n="step4Desc">根据您的选择，AI 将生成最适合您的 UI 设计提示词。</p>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label for="promptLanguage" class="block font-bold mb-2" data-i18n="promptLanguageLabel">提示词语言:</label>
                                    <select id="promptLanguage" class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600 dark:text-gray-200">
                                        <option value="en" selected data-i18n="langEnglish">English (英文)</option>
                                        <option value="zh" data-i18n="langChinese">中文 (Chinese)</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="promptDetailLevel" class="block font-bold mb-2" data-i18n="promptDetailLevelLabel">提示词详细程度:</label>
                                    <select id="promptDetailLevel" class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600 dark:text-gray-200">
                                        <option value="concise" data-i18n="detailConcise">简洁</option>
                                        <option value="standard" selected data-i18n="detailStandard">标准</option>
                                        <option value="detailed" data-i18n="detailDetailed">非常详细</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="aspectRatio" class="block font-bold mb-2" data-i18n="aspectRatioLabel">图片比例/屏幕尺寸:</label>
                                    <select id="aspectRatio" class="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-600 dark:text-gray-200">
                                        <option value="" data-i18n="aspectRatioDefault">默认/无指定</option>
                                        <option value="16:9" data-i18n="aspectRatio169">16:9 (宽屏)</option>
                                        <option value="9:16" data-i18n="aspectRatio916">9:16 (手机竖屏)</option>
                                        <option value="1:1" data-i18n="aspectRatio11">1:1 (方形)</option>
                                        <option value="4:3" data-i18n="aspectRatio43">4:3 (标准)</option>
                                        <option value="3:2" data-i18n="aspectRatio32">3:2</option>
                                        <option value="21:9" data-i18n="aspectRatio219">21:9 (超宽屏)</option>
                                        <option value="custom" data-i18n="aspectRatioCustom">自定义</option>
                                    </select>
                                </div>
                                <div id="customAspectRatioContainer" class="hidden">
                                     <label for="customAspectRatioInput" class="block font-bold mb-2" data-i18n="customAspectRatioLabel">自定义比例 (如 1920x1080):</label>
                                     <input type="text" id="customAspectRatioInput" class="w-full p-2 border rounded" data-i18n-placeholder="customAspectRatioPlaceholder" placeholder="例如: 1024x768">
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <label for="additionalDetails" class="block font-bold mb-2" data-i18n="additionalDetailsLabel">更多细节 (可选):</label>
                                <textarea id="additionalDetails" rows="3" class="w-full p-2 border rounded" data-i18n-placeholder="additionalDetailsPlaceholder" placeholder="例如：深色模式、动画效果、特定情感氛围等"></textarea>
                            </div>
                            
                            <div class="mb-6">
                                <label for="negativePrompt" class="block font-bold mb-2" data-i18n="negativePromptLabel">反向提示词 (不希望出现的内容, 可选):</label>
                                <textarea id="negativePrompt" rows="2" class="w-full p-2 border rounded" data-i18n-placeholder="negativePromptPlaceholder" placeholder="例如：模糊、文字、丑陋、低质量"></textarea>
                            </div>

                            <div class="mb-4">
                                <h4 class="font-medium mb-2" data-i18n="keywordsTitle">常用关键词 (点击添加):</h4>
                                <div id="keywordSnippetsContainer" class="flex flex-wrap gap-2">
                                    <!-- Keywords will be populated by JS -->
                                </div>
                            </div>

                            <div class="ai-progress-container mb-4" aria-label="AI生成进度">
                                <div class="ai-progress-bar" id="aiProgressBar"></div>
                            </div>

                            <div class="mb-6">
                                <div class="flex justify-between items-center mb-2">
                                    <label for="generatedPrompt" class="block font-bold" data-i18n="generatedPromptLabel">生成的提示词:</label>
                                    <div>
                                        <button id="editPromptBtn" class="btn-secondary px-3 py-1 text-sm rounded-md mr-2" aria-label="编辑或保存提示词">
                                            <i class="fas fa-edit mr-1" aria-hidden="true"></i> <span data-i18n="editButton">编辑</span>
                                        </button>
                                        <button id="copyPromptBtn" class="p-2 bg-indigo-100 text-indigo-600 dark:bg-indigo-900 dark:text-indigo-300 rounded hover:bg-indigo-200 dark:hover:bg-indigo-800 transition-colors tooltip" aria-label="复制提示词">
                                            <i class="fas fa-copy" aria-hidden="true"></i>
                                            <span class="tooltip-text" data-i18n="copyTooltip">复制提示词</span>
                                        </button>
                                        <span id="copyStatus" class="absolute top-2 right-12 text-green-500 text-sm font-medium opacity-0 transition-opacity" aria-live="polite"></span>
                                    </div>
                                </div>
                                <textarea id="generatedPrompt" class="w-full p-4 rounded-md generated-prompt-area custom-scrollbar" readonly aria-live="polite"><span data-i18n="clickGeneratePrompt">请点击"生成提示词"按钮来获取您的 UI 设计提示词...</span></textarea>
                            </div>
                            
                            <div class="mb-4">
                                <div class="flex items-center gap-4 mb-3">
                                    <button id="generateVariationsBtn" class="btn-secondary py-2 px-4 rounded-md hidden items-center justify-center">
                                        <i class="fas fa-lightbulb mr-2" aria-hidden="true"></i> <span data-i18n="generateVariationsButton">生成提示词变体</span>
                                    </button>
                                    <button id="generateVariationsFromEditedBtn" class="btn-secondary py-2 px-4 rounded-md hidden items-center justify-center">
                                        <i class="fas fa-magic mr-2" aria-hidden="true"></i> <span data-i18n="generateVariationsFromEditedButton">从编辑内容生成变体</span>
                                    </button>
                                </div>
                                <div id="variationControlsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3 hidden">
                                    <div>
                                        <label for="numVariations" class="block text-sm font-medium mb-1" data-i18n="numVariationsLabel">变体数量:</label>
                                        <input type="number" id="numVariations" value="3" min="1" max="5" class="w-full p-2 border rounded">
                                    </div>
                                    <div>
                                        <label for="variationDegree" class="block text-sm font-medium mb-1" data-i18n="variationDegreeLabel">变体差异度:</label>
                                        <select id="variationDegree" class="w-full p-2 border rounded">
                                            <option value="subtle" data-i18n="variationDegreeSubtle">细微调整</option>
                                            <option value="creative" selected data-i18n="variationDegreeCreative">创意发挥</option>
                                            <option value="diverse" data-i18n="variationDegreeDiverse">多样探索</option>
                                        </select>
                                    </div>
                                </div>
                                <div id="promptVariationsContainer" class="mt-3 space-y-3" aria-live="polite">
                                    <!-- Prompt variations will be shown here in cards -->
                                </div>
                            </div>


                            <div class="flex justify-between items-center">
                                <button id="prevStep4" class="btn-secondary px-6 py-3 rounded-md" data-i18n="prevButton">上一步</button>
                                <div class="flex items-center space-x-2">
                                     <button id="sharePromptButton" class="hidden btn-secondary p-3 rounded-md tooltip" aria-label="分享提示词 (开发中)">
                                        <i class="fas fa-share-alt" aria-hidden="true"></i>
                                        <span class="tooltip-text" data-i18n="shareTooltip">分享提示词 (开发中)</span>
                                    </button>
                                    <button id="generatePrompt" class="btn-primary px-6 py-3 rounded-md flex items-center justify-center">
                                        <span class="button-text" data-i18n="generateButton">生成提示词</span>
                                        <span class="loading-spinner hidden ml-2"><i class="fas fa-spinner fa-spin" aria-hidden="true"></i></span>
                                    </button>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </main>

            <!-- 右侧栏 - 预览和提示 -->
            <aside class="space-y-6">
                <section class="card p-4" aria-labelledby="currentSelectionTitleHeading">
                    <h3 id="currentSelectionTitleHeading" class="text-lg font-medium mb-3" data-i18n="currentSelectionTitle">当前选择</h3>
                    <ul class="list-none space-y-2 text-sm">
                        <li id="selectedPurpose"><i class="fas fa-bullseye mr-2 text-indigo-500 w-4 text-center" aria-hidden="true"></i> <span data-i18n="selectedPurposePrefix">设计目的: </span><span class="font-semibold" data-i18n="notSelected">未选择</span></li>
                        <li id="selectedIndustry"><i class="fas fa-building mr-2 text-indigo-500 w-4 text-center" aria-hidden="true"></i> <span data-i18n="selectedIndustryPrefix">行业: </span><span class="font-semibold" data-i18n="notSelected">未选择</span></li>
                        <li id="selectedStyle"><i class="fas fa-palette mr-2 text-indigo-500 w-4 text-center" aria-hidden="true"></i> <span data-i18n="selectedStylePrefix">风格: </span><span class="font-semibold" data-i18n="notSelected">未选择</span></li>
                        <li id="selectedColor"><i class="fas fa-fill-drip mr-2 text-indigo-500 w-4 text-center" aria-hidden="true"></i> <span data-i18n="selectedColorPrefix">主题色: </span><span class="font-semibold">#6366F1</span></li>
                        <li id="selectedComponentsCount"><i class="fas fa-cubes mr-2 text-indigo-500 w-4 text-center" aria-hidden="true"></i> <span data-i18n="selectedComponentsPrefix">已选组件: </span><span class="font-semibold">0 <span data-i18n="countUnit">个</span></span></li>
                    </ul>
                </section>

                <section class="card p-4" aria-labelledby="componentPreviewTitleHeading">
                    <h3 id="componentPreviewTitleHeading" class="text-lg font-medium mb-3" data-i18n="componentPreviewTitle">UI 组件预览</h3>
                    <div class="component-preview min-h-[100px]" id="previewContainer" aria-live="polite">
                        <div class="preview-placeholder text-center py-4">
                            <p data-i18n="previewPlaceholderText">选择组件后会在这里显示预览</p>
                            <i class="fas fa-arrow-left text-2xl mt-2" aria-hidden="true"></i>
                        </div>
                    </div>
                </section>
                
                <section class="card p-4" aria-labelledby="historyTitleHeading">
                    <div class="flex justify-between items-center mb-3">
                        <h3 id="historyTitleHeading" class="text-lg font-medium" data-i18n="historyTitle">提示词历史</h3>
                        <button id="clearHistoryBtn" class="text-xs text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300" data-i18n="clearHistoryButton">清空历史</button>
                    </div>
                    <div class="mb-3">
                        <input type="text" id="historySearchInput" class="w-full p-2 border rounded text-sm" data-i18n-placeholder="searchHistoryPlaceholder" placeholder="搜索历史记录..." aria-label="搜索历史记录">
                    </div>
                    <div id="promptHistoryContainer" class="max-h-60 overflow-y-auto custom-scrollbar space-y-1" aria-live="polite">
                        <p class="text-sm text-gray-500 text-center py-4" data-i18n="noHistory">暂无历史记录</p>
                    </div>
                </section>

                <section class="card p-4" aria-labelledby="tipsTitleHeading">
                    <h3 id="tipsTitleHeading" class="text-lg font-medium mb-3" data-i18n="tipsTitle">提示和技巧</h3>
                    <ul class="list-disc pl-5 text-sm space-y-1">
                        <li data-i18n="tip1">选择清晰的设计目的和行业。</li>
                        <li data-i18n="tip2">尝试不同的风格与颜色组合。</li>
                        <li data-i18n="tip3">在“更多细节”中提供具体要求，如品牌调性、目标用户画像等。</li>
                        <li data-i18n="tip4">使用关键词片段快速添加常用修饰词。</li>
                        <li data-i18n="tip5">详细和具体的提示词能让AI生成更好的UI结果。</li>
                        <li data-i18n="tip6">使用反向提示词排除不想要的内容。</li>
                        <li data-i18n="tip7">指定图片比例有助于AI生成符合预期的构图。</li>
                    </ul>
                </section>
            </aside>
        </div>

        <footer class="text-center mt-12 text-gray-500 dark:text-gray-400 text-sm">
            &copy; <span id="currentYear">2024</span> <span data-i18n="footerText">AI UI 提示词生成器 Pro. </span>
            <button id="exportConfigBtn" class="ml-2 text-indigo-500 hover:underline" data-i18n="exportConfigButton">导出配置</button> |
            <label for="importConfigFile" class="ml-1 text-indigo-500 hover:underline cursor-pointer" data-i18n="importConfigButton">导入配置</label>
            <input type="file" id="importConfigFile" class="hidden" accept=".json" aria-label="导入配置文件">
        </footer>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitleHeading">
        <div class="modal p-0 custom-scrollbar"> <!-- p-0 to allow full-width tabs -->
            <div class="flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700">
                <h3 id="settingsModalTitleHeading" class="text-xl font-bold" data-i18n="settingsModalTitle">设置</h3>
                <button id="closeSettingsModal" class="text-gray-400 hover:text-gray-500 dark:text-gray-500 dark:hover:text-gray-400 transition-colors" aria-label="关闭设置"><i class="fas fa-times text-xl" aria-hidden="true"></i></button>
            </div>

            <div class="settings-tabs flex border-b border-gray-200 dark:border-gray-700 px-6" role="tablist">
                <button class="settings-tab-button tab-button py-3 px-4 text-sm font-medium active" data-tab="openaiSettingsTab" data-i18n="openaiSettingsTabTitle" role="tab" aria-controls="openaiSettingsTab" aria-selected="true">OpenAI</button>
                <button class="settings-tab-button tab-button py-3 px-4 text-sm font-medium" data-tab="customKeywordsTab" data-i18n="customKeywordsTabTitle" role="tab" aria-controls="customKeywordsTab" aria-selected="false">自定义关键词</button>
            </div>

            <div class="p-6">
                <!-- OpenAI Settings Tab Content -->
                <section id="openaiSettingsTab" class="settings-tab-content active space-y-4" role="tabpanel" aria-labelledby="openaiSettingsTabTitle">
                    <div class="setting-item p-3 rounded-lg">
                        <label for="apiKey" class="block text-sm font-medium mb-1" data-i18n="apiKeyLabel">API Key</label>
                        <div class="input-container"><input type="password" id="apiKey" class="w-full p-2 border rounded" placeholder="sk-********" aria-describedby="apiKeyDesc"><i class="fas fa-key input-icon" aria-hidden="true"></i></div>
                        <p id="apiKeyDesc" class="text-xs text-gray-500 mt-1" data-i18n="apiKeyDesc">您的 API 密钥将安全地存储在本地浏览器中。</p>
                    </div>
                    <div class="setting-item p-3 rounded-lg">
                        <label for="baseUrl" class="block text-sm font-medium mb-1" data-i18n="baseUrlLabel">Base URL (可选)</label>
                        <div class="input-container"><input type="text" id="baseUrl" class="w-full p-2 border rounded" placeholder="https://api.openai.com/v1" aria-describedby="baseUrlDesc"><i class="fas fa-link input-icon" aria-hidden="true"></i></div>
                        <p id="baseUrlDesc" class="text-xs text-gray-500 mt-1" data-i18n="baseUrlDesc">自定义 API 端点。如果留空，将使用 OpenAI 官方地址。通常以 /v1 结尾。</p>
                    </div>
                    <div class="setting-item p-3 rounded-lg">
                        <label for="modelSelect" class="block text-sm font-medium mb-1" data-i18n="modelLabel">模型</label>
                        <div class="flex items-center space-x-2">
                            <div class="relative flex-grow">
                                <select id="modelSelect" class="w-full p-2 border rounded appearance-none" aria-label="选择AI模型">
                                    <option value="gpt-4o" data-i18n="modelGpt4o">GPT-4o (推荐)</option>
                                    <option value="custom" data-i18n="modelCustom">自定义模型</option>
                                </select>
                                <div class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none"><i class="fas fa-chevron-down text-gray-400" aria-hidden="true"></i></div>
                            </div>
                            <button id="fetchModelsButton" title="获取可用模型列表" aria-label="获取可用模型列表" class="p-2 bg-indigo-100 text-indigo-600 rounded-md hover:bg-indigo-200 dark:bg-indigo-800 dark:text-indigo-300 transition-colors">
                                <i class="fas fa-sync-alt" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                    <div id="customModelContainer" class="setting-item p-3 rounded-lg hidden">
                        <label for="customModelInput" class="block text-sm font-medium mb-1" data-i18n="customModelNameLabel">自定义模型名称</label>
                        <div class="input-container"><input type="text" id="customModelInput" class="w-full p-2 border rounded" placeholder="例如: gpt-4-turbo"><i class="fas fa-robot input-icon" aria-hidden="true"></i></div>
                    </div>
                </section>

                <!-- Custom Keywords Tab Content -->
                <section id="customKeywordsTab" class="settings-tab-content space-y-4" role="tabpanel" aria-labelledby="customKeywordsTabTitle">
                    <div>
                        <label for="newCustomKeyword" class="block text-sm font-medium mb-1" data-i18n="newCustomKeywordLabel">添加新关键词:</label>
                        <div class="flex gap-2">
                            <input type="text" id="newCustomKeyword" class="flex-grow p-2 border rounded" data-i18n-placeholder="newCustomKeywordPlaceholder" placeholder="例如: 赛博朋克风格">
                            <button id="addCustomKeywordBtn" class="btn-secondary px-4 py-2 rounded-md" data-i18n="addButton">添加</button>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-sm font-medium mb-2" data-i18n="myKeywordsLabel">我的关键词:</h4>
                        <div id="customKeywordsList" class="flex flex-wrap gap-2 max-h-40 overflow-y-auto custom-scrollbar p-1" aria-live="polite">
                            <p class="text-xs text-gray-500" data-i18n="noCustomKeywords">暂无自定义关键词。</p>
                        </div>
                    </div>
                </section>
            </div>

            <div class="mt-6 p-6 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3">
                <button id="resetSettings" class="btn-secondary px-4 py-2 rounded-md" data-i18n="resetButton">重置</button>
                <button id="saveSettings" class="btn-primary px-4 py-2 rounded-md" data-i18n="saveButton">保存</button>
            </div>
        </div>
    </div>

    <!-- Tutorial Overlay -->
    <div id="tutorialOverlay" class="tutorial-overlay" role="dialog" aria-modal="true" aria-labelledby="tutorialTitleHeading">
        <div class="tutorial-box">
            <h2 id="tutorialTitleHeading" class="text-2xl font-bold mb-4" data-i18n="welcomeTitle">欢迎使用 AI UI 提示词生成器 Pro!</h2>
            <p class="mb-6" data-i18n="welcomeDesc">只需简单几步，即可生成专业的UI设计提示词。点击下方按钮开始您的设计之旅，或随时点击右上角的 <i class="fas fa-question-circle" aria-hidden="true"></i> 查看帮助。</p>
            <button id="closeTutorialBtn" class="btn-primary px-6 py-3 rounded-md" data-i18n="startTourButton">开始使用</button>
        </div>
    </div>

</body>
<!-- JavaScript -->
<script>
    // AI UI Prompt Generator Pro - v1.2 (Final Polish)
    (function () {
        // --- Elements Cache ---
        const elements = {
            themeToggle: document.getElementById('themeToggle'),
            languageSelector: document.getElementById('languageSelector'),
            currentDisplayLang: document.getElementById('currentDisplayLang'),
            languageDropdown: document.getElementById('languageDropdown'),
            settingsButton: document.getElementById('settingsButton'),
            showHelpButton: document.getElementById('showHelpButton'),
            randomSurpriseBtn: document.getElementById('randomSurpriseBtn'),

            progressBar: document.getElementById('progressBar'),
            stepIndicators: [
                document.getElementById('stepIndicator1'),
                document.getElementById('stepIndicator2'),
                document.getElementById('stepIndicator3'),
                document.getElementById('stepIndicator4')
            ],
            wizardSteps: {
                step1: document.getElementById('wizardStep1'),
                step2: document.getElementById('wizardStep2'),
                step3: document.getElementById('wizardStep3'),
                step4: document.getElementById('wizardStep4')
            },
            navigationButtons: {
                nextStep1: document.getElementById('nextStep1'),
                prevStep2: document.getElementById('prevStep2'), nextStep2: document.getElementById('nextStep2'),
                prevStep3: document.getElementById('prevStep3'), nextStep3: document.getElementById('nextStep3'),
                prevStep4: document.getElementById('prevStep4')
            },

            purposeCards: document.querySelectorAll('#wizardStep1 .purpose-card'),
            industryTags: document.querySelectorAll('#wizardStep1 .industry-tag'),
            styleCards: document.querySelectorAll('#wizardStep2 .style-card'),
            templateSelectionContainer: document.getElementById('templateSelectionContainer'),

            colorSwatches: document.querySelectorAll('#wizardStep3 .color-swatch'),
            customColorPreview: document.getElementById('customColorPreview'),
            customColorInput: document.getElementById('customColorInput'),
            applyCustomColor: document.getElementById('applyCustomColor'),
            
            componentSearchInput: document.getElementById('componentSearch'),
            clearSearchButton: document.getElementById('clearSearch'),
            categoryPillsElements: document.querySelectorAll('#wizardStep3 .category-pill'),
            componentContainer: document.getElementById('componentContainer'),
            componentTagsElements: document.querySelectorAll('#wizardStep3 .component-tag'), 

            promptLanguageSelect: document.getElementById('promptLanguage'),
            promptDetailLevelSelect: document.getElementById('promptDetailLevel'),
            aspectRatioSelect: document.getElementById('aspectRatio'),
            customAspectRatioContainer: document.getElementById('customAspectRatioContainer'),
            customAspectRatioInput: document.getElementById('customAspectRatioInput'),
            additionalDetails: document.getElementById('additionalDetails'),
            negativePrompt: document.getElementById('negativePrompt'),
            keywordSnippetsContainer: document.getElementById('keywordSnippetsContainer'),
            aiProgressBar: document.getElementById('aiProgressBar'),
            generatedPrompt: document.getElementById('generatedPrompt'), 
            editPromptBtn: document.getElementById('editPromptBtn'),
            copyPromptBtn: document.getElementById('copyPromptBtn'),
            copyStatus: document.getElementById('copyStatus'),
            sharePromptButton: document.getElementById('sharePromptButton'),
            generatePromptButton: document.getElementById('generatePrompt'),
            
            generateVariationsBtn: document.getElementById('generateVariationsBtn'),
            generateVariationsFromEditedBtn: document.getElementById('generateVariationsFromEditedBtn'),
            variationControlsContainer: document.getElementById('variationControlsContainer'),
            numVariationsInput: document.getElementById('numVariations'),
            variationDegreeSelect: document.getElementById('variationDegree'),
            promptVariationsContainer: document.getElementById('promptVariationsContainer'),

            selectedPurpose: document.getElementById('selectedPurpose'),
            selectedIndustry: document.getElementById('selectedIndustry'),
            selectedStyle: document.getElementById('selectedStyle'),
            selectedColor: document.getElementById('selectedColor'),
            selectedComponentsCount: document.getElementById('selectedComponentsCount'),
            previewContainer: document.getElementById('previewContainer'),
            
            historySearchInput: document.getElementById('historySearchInput'),
            promptHistoryContainer: document.getElementById('promptHistoryContainer'),
            clearHistoryBtn: document.getElementById('clearHistoryBtn'),

            settingsModal: document.getElementById('settingsModal'),
            closeSettingsModal: document.getElementById('closeSettingsModal'),
            settingsTabButtons: document.querySelectorAll('.settings-tab-button'),
            settingsTabContents: document.querySelectorAll('.settings-tab-content'),
            apiKeyInput: document.getElementById('apiKey'),
            baseUrlInput: document.getElementById('baseUrl'),
            modelSelect: document.getElementById('modelSelect'),
            fetchModelsButton: document.getElementById('fetchModelsButton'),
            customModelContainer: document.getElementById('customModelContainer'),
            customModelInput: document.getElementById('customModelInput'),
            newCustomKeywordInput: document.getElementById('newCustomKeyword'),
            addCustomKeywordBtn: document.getElementById('addCustomKeywordBtn'),
            customKeywordsList: document.getElementById('customKeywordsList'),
            saveSettingsButton: document.getElementById('saveSettings'),
            resetSettingsButton: document.getElementById('resetSettings'),

            exportConfigBtn: document.getElementById('exportConfigBtn'),
            importConfigFile: document.getElementById('importConfigFile'),
            currentYear: document.getElementById('currentYear'),

            tutorialOverlay: document.getElementById('tutorialOverlay'),
            closeTutorialBtn: document.getElementById('closeTutorialBtn'),
        };

        // --- State Management ---
        const state = {
            uiLanguage: localStorage.getItem('uiLanguage') || 'zh-CN',
            theme: localStorage.getItem('theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'),
            currentStep: 1,
            promptLanguage: 'en',
            promptDetailLevel: 'standard',
            aspectRatio: '',
            customAspectRatio: '',
            selections: {
                purpose: '', purposeText: '',
                industry: '', industryText: '',
                style: '',
                color: '#6366F1',
                components: [], componentIds: [],
                additionalDetails: '',
                negativePrompt: '',
                templateId: null,
            },
            isGeneratingPrompt: false,
            isEditingPrompt: false,
            isCopyAnimationRunning: false,
            promptHistory: JSON.parse(localStorage.getItem('promptHistory_v1.2')) || [], 
            customKeywords: JSON.parse(localStorage.getItem('customKeywords_v1.2')) || [], 
            hasSeenTutorial: localStorage.getItem('hasSeenTutorial_v1.2') === 'true', 
            variationCardStates: {}, // To store edit state for each variation card { cardId: { isEditing: false } }
        };
        
        // --- Data Definitions ---
        const TEMPLATE_DEFINITIONS = [ 
            { id: 'loginModern', nameKey: 'templateLoginModernName', descriptionKey: 'templateLoginModernDesc', style: '现代', componentIds: ['contactform'], color: '#3F51B5', detailsKey: 'templateLoginModernDetails' },
            { id: 'ecomProduct', nameKey: 'templateEcomProductName', descriptionKey: 'templateEcomProductDesc', style: '简约', componentIds: ['gallery', 'testimonials'], color: '#4CAF50', detailsKey: 'templateEcomProductDetails' },
            { id: 'dashboardDark', nameKey: 'templateDashboardDarkName', descriptionKey: 'templateDashboardDarkDesc', style: '科技', componentIds: ['charts', 'datatable', 'sidenav'], color: '#607D8B', detailsKey: 'templateDashboardDarkDetails' },
        ];

        const KEYWORD_DEFINITIONS = [ 
            { id: 'darkMode', textKey: 'keywordDarkMode', icon: 'fas fa-moon' },
            { id: 'lightMode', textKey: 'keywordLightMode', icon: 'fas fa-sun' },
            { id: 'glassmorphism', textKey: 'keywordGlassmorphism', icon: 'fas fa-square-opacity' },
            { id: 'neumorphism', textKey: 'keywordNeumorphism', icon: 'fas fa-circle-notch' },
            { id: '3dicons', textKey: 'keyword3DIcons', icon: 'fas fa-cubes' },
            { id: 'gradients', textKey: 'keywordGradients', icon: 'fas fa-palette' },
            { id: 'animations', textKey: 'keywordAnimations', icon: 'fas fa-film' },
            { id: 'playful', textKey: 'keywordPlayful', icon: 'fas fa-puzzle-piece' },
            { id: 'professional', textKey: 'keywordProfessional', icon: 'fas fa-briefcase' },
            { id: 'futuristic', textKey: 'keywordFuturistic', icon: 'fas fa-rocket' },
        ];

        // --- Localization (i18n) ---
        const i18nData = {
            'en-US': {
                appTitle: "AI UI Prompt Generator Pro",
                randomSurpriseTooltip: "Random Inspiration",
                themeToggleTooltip: "Toggle Theme",
                languageSelectorTooltip: "Select UI Language",
                settingsTooltip: "Settings", 
                helpTooltip: "Help/Tutorial",
                step1Title: "Design Purpose",
                step1Desc: "First, choose your UI design purpose and industry. This will help us generate more accurate prompts for you.",
                step1PurposeQuestion: "What is your UI for?",
                purposeWebsite: "Website", purposeWebsiteDesc: "Corporate sites, product showcases, etc.",
                purposeMobileApp: "Mobile App", purposeMobileAppDesc: "iOS, Android platforms, etc.",
                purposeDashboard: "Dashboard", purposeDashboardDesc: "Data analysis, monitoring, etc.",
                purposeEcommerce: "E-commerce", purposeEcommerceDesc: "Online stores, shopping platforms, etc.",
                purposeMarketing: "Marketing", purposeMarketingDesc: "Landing pages, promotional events, etc.",
                purposeSocial: "Social Media", purposeSocialDesc: "Social platforms, community apps, etc.",
                purposeEducation: "Education Platform", purposeEducationDesc: "Learning systems, online classrooms, etc.",
                purposeProductivity: "Productivity Tool", purposeProductivityDesc: "Task management, collaboration tools, etc.",
                purposeEntertainment: "Entertainment App", purposeEntertainmentDesc: "Video, games, music, etc.",
                purposeHealth: "Health App", purposeHealthDesc: "Fitness, medical monitoring, etc.",
                purposeTravel: "Travel Service", purposeTravelDesc: "Travel planning, booking services, etc.",
                purposeFinance: "Financial Tool", purposeFinanceDesc: "Investment analysis, budget management, etc.",
                purposeOther: "Other", purposeOtherDesc: "Custom purpose",
                step1IndustryQuestion: "Select Industry Domain",
                industryTech: "Tech", industryFinance: "Finance", industryHealthcare: "Healthcare", industryEducation: "Education", industryEntertainment: "Entertainment", industryFood: "Food & Beverage", industryTravel: "Travel & Hospitality", industryRealEstate: "Real Estate", industryFashion: "Fashion & Apparel", industryRetail: "Retail", industryManufacturing: "Manufacturing", industryTransportation: "Transportation", industryEnergy: "Energy", industryAgriculture: "Agriculture", industryConstruction: "Construction", industryMedia: "Media", industrySports: "Sports", industryGaming: "Gaming", industryAutomotive: "Automotive", industryLegal: "Legal", industryGovernment: "Government", industryNonprofit: "Non-profit", industryArt: "Art & Culture", industryOther: "Other",
                nextButton: "Next", prevButton: "Previous", applyButton: "Apply", editButton: "Edit", saveButton: "Save", addButton: "Add", removeButton: "Remove",
                step2Title: "Style Selection",
                step2Desc: "Choose your preferred UI style. We'll generate prompts that better match your aesthetic.",
                step2TemplateQuestion: "Or choose a design template to start? (Optional)",
                step2StyleQuestion: "Select Design Style",
                styleMinimalist: "Minimalist", styleModern: "Modern", styleRetro: "Retro", styleCartoon: "Cartoon", styleTech: "Tech", styleHandDrawn: "Hand-drawn", styleUltraMinimalist: "Ultra Minimal", styleFlat: "Flat Design", styleSkeuomorphic: "Skeuomorphic", styleNeumorphic: "Neumorphic", styleFuturistic: "Futuristic", styleInkWash: "Ink Wash",
                step3Title: "Color & Components",
                step3Desc: "Select your theme color and required UI components to help us generate better prompts.",
                step3ColorQuestion: "Theme Color",
                step3ComponentQuestion: "Select Required UI Components",
                searchComponentsPlaceholder: "Search components...",
                categoryAll: "All", categoryNav: "Navigation", categoryContent: "Content", categoryInteraction: "Interaction", categoryData: "Data", categoryMobile: "Mobile", categoryDialog: "Dialogs",
                componentNavbar: "Navigation Bar", componentSearchBox: "Search Box", componentBreadcrumbs: "Breadcrumbs", componentSidenav: "Side Navigation", componentNavCard: "Navigation Card", componentBackToTop: "Back to Top",
                componentHero: "Hero Section", componentContentBlock: "Content Block", componentGallery: "Image Gallery", componentCarousel: "Carousel/Slider", componentVideoPlayer: "Video Player", componentTestimonials: "Testimonials", componentTeam: "Team Members", componentProductDisplay: "Product Display", componentBlogPost: "Blog Post", componentFaq: "FAQ Accordion", componentCodeDisplay: "Code Display",
                componentContactForm: "Contact Form", componentComments: "Comment Section", componentSocialShare: "Social Share", componentFab: "Floating Action Button", componentSubscribe: "Subscription Form", componentShoppingCart: "Shopping Cart", componentFilters: "Filters", componentLangSwitcher: "Language Switcher", componentCookieConsent: "Cookie Consent",
                componentDataTable: "Data Table", componentCharts: "Charts/Graphs", componentMap: "Map Integration", componentCalendar: "Event Calendar", componentStatsCard: "Statistics Card", componentTagCloud: "Tag Cloud", componentProgressIndicator: "Progress Indicator",
                componentBottomNav: "Bottom Navigation (Mobile)", componentMobilePayment: "Mobile Payment", componentBiometric: "Biometric Login", componentSwipeActions: "Swipe Actions", componentPullToRefresh: "Pull to Refresh", componentGeolocation: "Geolocation", componentQrcode: "QR Code Scanner", componentGestures: "Gesture Hints", componentResponsiveMenu: "Responsive Menu",
                componentModal: "Modal Dialog", componentAlertDialog: "Alert Dialog", componentConfirmDialog: "Confirmation Dialog", componentNotification: "Notification Popup", componentLoginDialog: "Login Dialog", componentQuickBuy: "Quick Buy Popup", componentShareDialog: "Share Dialog", componentImageViewer: "Image Viewer", componentDatePicker: "Date Picker", componentFilterDialog: "Filter Dialog", componentFullscreenSearch: "Fullscreen Search", componentLoadingDialog: "Loading Dialog",
                step4Title: "Generate Prompt",
                step4Desc: "Based on your selections, AI will generate the most suitable UI design prompt for you.",
                promptLanguageLabel: "Prompt Language:", langEnglish: "English", langChinese: "Chinese (中文)",
                promptDetailLevelLabel: "Prompt Detail Level:", detailConcise: "Concise", detailStandard: "Standard", detailDetailed: "Very Detailed",
                aspectRatioLabel: "Aspect Ratio/Screen Size:", aspectRatioDefault: "Default/None", aspectRatio169: "16:9 (Widescreen)", aspectRatio916: "9:16 (Mobile Portrait)", aspectRatio11: "1:1 (Square)", aspectRatio43: "4:3 (Standard)", aspectRatio32: "3:2", aspectRatio219: "21:9 (Ultrawide)", aspectRatioCustom: "Custom",
                customAspectRatioLabel: "Custom Ratio (e.g., 1920x1080):", customAspectRatioPlaceholder: "e.g., 1024x768",
                additionalDetailsLabel: "More Details (Optional):", additionalDetailsPlaceholder: "e.g., dark mode, animations, specific mood",
                negativePromptLabel: "Negative Prompt (Content to avoid, Optional):", negativePromptPlaceholder: "e.g., blurry, text, ugly, low quality",
                keywordsTitle: "Common Keywords (Click to add):",
                generatedPromptLabel: "Generated Prompt:",
                clickGeneratePrompt: "Click the 'Generate Prompt' button to get your UI design prompt...",
                copyTooltip: "Copy Prompt",
                shareTooltip: "Share Prompt (Coming Soon)",
                generateButton: "Generate Prompt",
                generateVariationsButton: "Generate Variations",
                generateVariationsFromEditedButton: "Variations from Edited",
                numVariationsLabel: "Number of Variations:", variationDegreeLabel: "Variation Difference:",
                variationDegreeSubtle: "Subtle Adjustments", variationDegreeCreative: "Creative Exploration", variationDegreeDiverse: "Diverse Ideas",
                currentSelectionTitle: "Current Selections",
                selectedPurposePrefix: "Purpose: ", selectedIndustryPrefix: "Industry: ", selectedStylePrefix: "Style: ", selectedColorPrefix: "Theme Color: ", selectedComponentsPrefix: "Selected Components: ", notSelected: "Not Selected", countUnit: " item(s)",
                componentPreviewTitle: "UI Component Preview",
                previewPlaceholderText: "Preview will appear here after selecting components",
                historyTitle: "Prompt History", clearHistoryButton: "Clear History", noHistory: "No history yet.", searchHistoryPlaceholder: "Search history...",
                tipsTitle: "Tips & Tricks",
                tip1: "Choose a clear design purpose and industry.",
                tip2: "Experiment with different style and color combinations.",
                tip3: "Provide specific requirements in 'More Details', like brand tone, target audience.",
                tip4: "Use keyword snippets to quickly add common modifiers.",
                tip5: "Detailed and specific prompts yield better UI generation results with AI.",
                tip6: "Use negative prompts to exclude unwanted content.",
                tip7: "Specify aspect ratio for better composition control.",
                footerText: "AI UI Prompt Generator Pro.",
                exportConfigButton: "Export Config", importConfigButton: "Import Config",
                settingsModalTitle: "Settings", 
                openaiSettingsTabTitle: "OpenAI", customKeywordsTabTitle: "Custom Keywords",
                apiKeyLabel: "API Key", apiKeyDesc: "Your API key is stored securely in your local browser.",
                baseUrlLabel: "Base URL (Optional)", baseUrlDesc: "Custom API endpoint. Defaults to OpenAI official if empty. Usually ends with /v1.",
                modelLabel: "Model", modelGpt4o: "GPT-4o (Recommended)", modelGpt4Turbo: "GPT-4 Turbo", modelGpt35Turbo: "GPT-3.5 Turbo", modelClaude35: "Claude 3.5 Sonnet", modelDeepseek: "DeepSeek Chat", modelCustom: "Custom Model",
                customModelNameLabel: "Custom Model Name",
                newCustomKeywordLabel: "Add New Keyword:", newCustomKeywordPlaceholder: "e.g., Cyberpunk style", myKeywordsLabel: "My Keywords:", noCustomKeywords: "No custom keywords yet.",
                resetButton: "Reset",
                welcomeTitle: "Welcome to AI UI Prompt Generator Pro!",
                welcomeDesc: "Generate professional UI design prompts in just a few simple steps. Click the button below to start your design journey, or click the <i class='fas fa-question-circle'></i> icon in the top right for help anytime.",
                startTourButton: "Get Started",
                saving: "Saving...", settingsSaved: "Settings saved!", settingsReset: "Settings reset to default.", apiKeyRequiredForModels: "API Key required to fetch models.", modelsFetched: "Model list updated.", invalidModelData: "Invalid model data received.", fetchModelsError: "Error fetching models",
                generatingButton: "Generating...", generatingPromptText: "AI is working hard to generate your prompt, please wait...", enhancingPromptText: "Connecting to AI service to enhance prompt...", generatingBasePromptText: "Generating base prompt...", promptEnhancedByAI: "Prompt enhanced by AI!", aiEnhancementFailed: "AI enhancement failed", apiKeyNotConfiguredBasePrompt: "API Key not configured, using base prompt.", invalidApiResponse: "Invalid API response format.", nothingToCopy: "Nothing to copy.", copySuccess: "Copied!", copyFailStatus: "Copy failed!",
                templateApplied: "Template applied!", keywordAlreadyAdded: "Keyword already added.", customKeywordAdded: "Custom keyword added.", customKeywordRemoved: "Custom keyword removed.", customKeywordExists: "This custom keyword already exists.",
                confirmClearHistory: "Are you sure you want to clear all history?", historyCleared: "History cleared.", historyLoaded: "Loaded from history.", loadTooltip: "Load", promptCopied: "Prompt copied!", copyFailed: "Copy failed.",
                configExported: "Configuration exported!", configImported: "Configuration imported successfully!", configImportError: "Error importing config", invalidConfigFile: "Invalid configuration file.",
                randomSetupGenerated: "Random setup generated! Feel free to adjust.",
                variationsGenerated: "Prompt variations generated!", errorGeneratingVariations: "Error generating variations.",
                generateMainPromptFirst: "Please generate the main prompt first.", generatingVariationsText: "Generating variations...", noVariationsGenerated: "Could not generate variations.",
                promptEditingActive: "Prompt editing active. Click 'Save' or 'Cancel Edit'.", promptSaved: "Prompt saved.",
                templateLoginModernName: "Modern Login Page", templateLoginModernDesc: "A sleek, modern login/signup form.", templateLoginModernDetails: "Focus on clarity and ease of use, with social login options.",
                templateEcomProductName: "E-commerce Product Page", templateEcomProductDesc: "Clean product display for an online store.", templateEcomProductDetails: "Highlight product images, clear call-to-action, customer reviews section.",
                templateDashboardDarkName: "Dark Themed Dashboard", templateDashboardDarkDesc: "Data-rich dashboard interface with a dark theme.", templateDashboardDarkDetails: "Include various charts, a data table, and a side navigation menu. Use glowing accents for important data points.",
                keywordDarkMode: "Dark Mode", keywordLightMode: "Light Mode", keywordGlassmorphism: "Glassmorphism", keywordNeumorphism: "Neumorphism",
                keyword3DIcons: "3D Icons", keywordGradients: "Gradients", keywordAnimations: "Subtle Animations", keywordPlayful: "Playful Vibe",
                keywordProfessional: "Professional Look", keywordFuturistic: "Futuristic Theme",
                errorOpenAI: "OpenAI API Error", errorNetwork: "Network Error", errorUnknown: "An unknown error occurred", invalidColorFormat: "Invalid color format.",
            },
            'zh-CN': {
                appTitle: "AI UI 提示词生成器 Pro",
                randomSurpriseTooltip: "随机灵感",
                themeToggleTooltip: "切换主题",
                languageSelectorTooltip: "选择界面语言",
                settingsTooltip: "设置", 
                helpTooltip: "帮助/教程",
                step1Title: "设计目的",
                step1Desc: "首先选择您的 UI 设计目的和行业，这将帮助我们为您生成更精准的提示词。",
                step1PurposeQuestion: "您的 UI 用于什么目的？",
                purposeWebsite: "网站", purposeWebsiteDesc: "公司官网、产品展示等",
                purposeMobileApp: "移动应用", purposeMobileAppDesc: "iOS、Android 等平台",
                purposeDashboard: "仪表盘", purposeDashboardDesc: "数据分析、监控等",
                purposeEcommerce: "电子商务", purposeEcommerceDesc: "在线商店、购物平台等",
                purposeMarketing: "营销推广", purposeMarketingDesc: "广告页面、活动推广等",
                purposeSocial: "社交媒体", purposeSocialDesc: "社交平台、社区应用等",
                purposeEducation: "教育平台", purposeEducationDesc: "学习系统、在线课堂等",
                purposeProductivity: "生产力工具", purposeProductivityDesc: "任务管理、协作工具等",
                purposeEntertainment: "娱乐应用", purposeEntertainmentDesc: "视频、游戏、音乐等",
                purposeHealth: "健康应用", purposeHealthDesc: "健身、医疗监测等",
                purposeTravel: "旅行服务", purposeTravelDesc: "旅游规划、预订服务等",
                purposeFinance: "金融工具", purposeFinanceDesc: "投资分析、预算管理等",
                purposeOther: "其他", purposeOtherDesc: "自定义目的",
                step1IndustryQuestion: "选择行业领域",
                industryTech: "科技", industryFinance: "金融", industryHealthcare: "医疗健康", industryEducation: "教育", industryEntertainment: "娱乐", industryFood: "餐饮", industryTravel: "旅游", industryRealEstate: "房地产", industryFashion: "时尚", industryRetail: "零售", industryManufacturing: "制造业", industryTransportation: "交通运输", industryEnergy: "能源", industryAgriculture: "农业", industryConstruction: "建筑", industryMedia: "媒体", industrySports: "体育", industryGaming: "游戏", industryAutomotive: "汽车", industryLegal: "法律", industryGovernment: "政府", industryNonprofit: "非营利组织", industryArt: "艺术文化", industryOther: "其他",
                nextButton: "下一步", prevButton: "上一步", applyButton: "应用", editButton: "编辑", saveButton: "保存", addButton: "添加", removeButton: "移除",
                step2Title: "风格选择",
                step2Desc: "选择您喜欢的 UI 风格，我们将据此生成更符合您审美的提示词。",
                step2TemplateQuestion: "或选择一个设计模板作为起点？ (可选)",
                step2StyleQuestion: "选择设计风格",
                styleMinimalist: "简约", styleModern: "现代", styleRetro: "复古", styleCartoon: "卡通", styleTech: "科技", styleHandDrawn: "手绘", styleUltraMinimalist: "极简", styleFlat: "扁平化", styleSkeuomorphic: "拟物化", styleNeumorphic: "新拟物", styleFuturistic: "未来主义", styleInkWash: "水墨",
                step3Title: "颜色和组件",
                step3Desc: "选择您喜欢的主题色和需要的 UI 组件，这将帮助我们更好地生成提示词。",
                step3ColorQuestion: "主题颜色",
                step3ComponentQuestion: "选择需要的 UI 组件",
                searchComponentsPlaceholder: "搜索组件...",
                categoryAll: "全部", categoryNav: "导航类", categoryContent: "内容类", categoryInteraction: "交互类", categoryData: "数据类", categoryMobile: "移动端", categoryDialog: "弹窗类",
                componentNavbar: "导航栏", componentSearchBox: "搜索框", componentBreadcrumbs: "面包屑导航", componentSidenav: "侧边导航", componentNavCard: "导航卡片", componentBackToTop: "返回顶部",
                componentHero: "Hero区域", componentContentBlock: "内容区块", componentGallery: "图片画廊", componentCarousel: "轮播图", componentVideoPlayer: "视频播放器", componentTestimonials: "客户评价", componentTeam: "团队成员", componentProductDisplay: "产品展示", componentBlogPost: "博客文章", componentFaq: "FAQ折叠", componentCodeDisplay: "代码展示",
                componentContactForm: "联系表单", componentComments: "评论区", componentSocialShare: "社交分享", componentFab: "悬浮按钮", componentSubscribe: "订阅组件", componentShoppingCart: "购物车", componentFilters: "筛选器", componentLangSwitcher: "语言切换", componentCookieConsent: "Cookie提示",
                componentDataTable: "数据表格", componentCharts: "图表", componentMap: "地图集成", componentCalendar: "活动日历", componentStatsCard: "统计卡片", componentTagCloud: "标签云", componentProgressIndicator: "进度指示",
                componentBottomNav: "底部导航栏", componentMobilePayment: "移动支付", componentBiometric: "生物识别", componentSwipeActions: "滑动操作", componentPullToRefresh: "下拉刷新", componentGeolocation: "地理定位", componentQrcode: "扫码功能", componentGestures: "手势提示", componentResponsiveMenu: "响应式菜单",
                componentModal: "模态弹窗", componentAlertDialog: "警告弹窗", componentConfirmDialog: "确认弹窗", componentNotification: "通知弹窗", componentLoginDialog: "登录弹窗", componentQuickBuy: "快速购买", componentShareDialog: "分享弹窗", componentImageViewer: "图片查看", componentDatePicker: "日期选择", componentFilterDialog: "筛选弹窗", componentFullscreenSearch: "全屏搜索", componentLoadingDialog: "加载弹窗",
                step4Title: "生成提示词",
                step4Desc: "根据您的选择，AI 将生成最适合您的 UI 设计提示词。",
                promptLanguageLabel: "提示词语言:", langEnglish: "English (英文)", langChinese: "中文 (Chinese)",
                promptDetailLevelLabel: "提示词详细程度:", detailConcise: "简洁", detailStandard: "标准", detailDetailed: "非常详细",
                aspectRatioLabel: "图片比例/屏幕尺寸:", aspectRatioDefault: "默认/无指定", aspectRatio169: "16:9 (宽屏)", aspectRatio916: "9:16 (手机竖屏)", aspectRatio11: "1:1 (方形)", aspectRatio43: "4:3 (标准)", aspectRatio32: "3:2", aspectRatio219: "21:9 (超宽屏)", aspectRatioCustom: "自定义",
                customAspectRatioLabel: "自定义比例 (如 1920x1080):", customAspectRatioPlaceholder: "例如: 1024x768",
                additionalDetailsLabel: "更多细节 (可选):", additionalDetailsPlaceholder: "例如：深色模式、动画效果、特定情感氛围等",
                negativePromptLabel: "反向提示词 (不希望出现的内容, 可选):", negativePromptPlaceholder: "例如：模糊、文字、丑陋、低质量",
                keywordsTitle: "常用关键词 (点击添加):",
                generatedPromptLabel: "生成的提示词:",
                clickGeneratePrompt: "请点击\"生成提示词\"按钮来获取您的 UI 设计提示词...",
                copyTooltip: "复制提示词",
                shareTooltip: "分享提示词 (开发中)",
                generateButton: "生成提示词",
                generateVariationsButton: "生成提示词变体",
                generateVariationsFromEditedButton: "从编辑内容生成变体",
                numVariationsLabel: "变体数量:", variationDegreeLabel: "变体差异度:",
                variationDegreeSubtle: "细微调整", variationDegreeCreative: "创意发挥", variationDegreeDiverse: "多样探索",
                currentSelectionTitle: "当前选择",
                selectedPurposePrefix: "设计目的: ", selectedIndustryPrefix: "行业: ", selectedStylePrefix: "风格: ", selectedColorPrefix: "主题色: ", selectedComponentsPrefix: "已选组件: ", notSelected: "未选择", countUnit: "个",
                componentPreviewTitle: "UI 组件预览",
                previewPlaceholderText: "选择组件后会在这里显示预览",
                historyTitle: "提示词历史", clearHistoryButton: "清空历史", noHistory: "暂无历史记录", searchHistoryPlaceholder: "搜索历史记录...",
                tipsTitle: "提示和技巧",
                tip1: "选择清晰的设计目的和行业。",
                tip2: "尝试不同的风格与颜色组合。",
                tip3: "在“更多细节”中提供具体要求，如品牌调性、目标用户画像等。",
                tip4: "使用关键词片段快速添加常用修饰词。",
                tip5: "详细和具体的提示词能让AI生成更好的UI结果。",
                tip6: "使用反向提示词排除不想要的内容。",
                tip7: "指定图片比例有助于AI生成符合预期的构图。",
                footerText: "AI UI 提示词生成器 Pro.",
                exportConfigButton: "导出配置", importConfigButton: "导入配置",
                settingsModalTitle: "设置", 
                openaiSettingsTabTitle: "OpenAI", customKeywordsTabTitle: "自定义关键词",
                apiKeyLabel: "API Key", apiKeyDesc: "您的 API 密钥将安全地存储在本地浏览器中。",
                baseUrlLabel: "Base URL (可选)", baseUrlDesc: "自定义 API 端点。如果留空，将使用 OpenAI 官方地址。通常以 /v1 结尾。",
                modelLabel: "模型", modelGpt4o: "GPT-4o (推荐)", modelGpt4Turbo: "GPT-4 Turbo", modelGpt35Turbo: "GPT-3.5 Turbo", modelClaude35: "Claude 3.5 Sonnet", modelDeepseek: "DeepSeek Chat", modelCustom: "自定义模型",
                customModelNameLabel: "自定义模型名称",
                newCustomKeywordLabel: "添加新关键词:", newCustomKeywordPlaceholder: "例如: 赛博朋克风格", myKeywordsLabel: "我的关键词:", noCustomKeywords: "暂无自定义关键词。",
                resetButton: "重置",
                welcomeTitle: "欢迎使用 AI UI 提示词生成器 Pro!",
                welcomeDesc: "只需简单几步，即可生成专业的UI设计提示词。点击下方按钮开始您的设计之旅，或随时点击右上角的 <i class='fas fa-question-circle'></i> 查看帮助。",
                startTourButton: "开始使用",
                saving: "保存中...", settingsSaved: "设置已保存!", settingsReset: "设置已重置为默认值。", apiKeyRequiredForModels: "获取模型列表需要API Key。", modelsFetched: "模型列表已更新。", invalidModelData: "收到的模型数据格式不正确。", fetchModelsError: "获取模型列表失败",
                generatingButton: "生成中...", generatingPromptText: "AI正在努力生成提示词，请稍等...", enhancingPromptText: "正在连接AI服务，增强提示词...", generatingBasePromptText: "正在生成基础提示词...", promptEnhancedByAI: "提示词已由AI增强!", aiEnhancementFailed: "AI增强失败", apiKeyNotConfiguredBasePrompt: "API Key未配置，已生成基础提示词。", invalidApiResponse: "无效的API响应格式。", nothingToCopy: "没有可复制的内容。", copySuccess: "复制成功!", copyFailStatus: "复制失败!",
                templateApplied: "模板已应用!", keywordAlreadyAdded: "关键词已添加。", customKeywordAdded: "自定义关键词已添加。", customKeywordRemoved: "自定义关键词已移除。", customKeywordExists: "该自定义关键词已存在。",
                confirmClearHistory: "确定要清空所有历史记录吗？", historyCleared: "历史记录已清空。", historyLoaded: "已从历史记录加载。", loadTooltip: "加载", promptCopied: "提示词已复制!", copyFailed: "复制失败。",
                configExported: "配置已导出!", configImported: "配置导入成功!", configImportError: "导入配置错误", invalidConfigFile: "无效的配置文件。",
                randomSetupGenerated: "随机配置已生成！请随意调整。",
                variationsGenerated: "提示词变体已生成！", errorGeneratingVariations: "生成变体时出错。",
                generateMainPromptFirst: "请先生成主提示词。", generatingVariationsText: "正在生成变体...", noVariationsGenerated: "未能生成变体。",
                promptEditingActive: "提示词编辑中，点击“保存”或“取消编辑”。", promptSaved: "提示词已保存。",
                templateLoginModernName: "现代登录页面", templateLoginModernDesc: "一个时尚、现代的登录/注册表单。", templateLoginModernDetails: "注重清晰度和易用性，带有社交登录选项。",
                templateEcomProductName: "电商产品页面", templateEcomProductDesc: "在线商店的简洁产品展示。", templateEcomProductDetails: "突出产品图片，清晰的行动号召按钮，客户评价区域。",
                templateDashboardDarkName: "暗黑主题仪表盘", templateDashboardDarkDesc: "数据丰富的暗黑主题仪表盘界面。", templateDashboardDarkDetails: "包含各种图表、一个数据表格和侧边导航菜单。对重要数据点使用发光强调。",
                keywordDarkMode: "深色模式", keywordLightMode: "浅色模式", keywordGlassmorphism: "玻璃拟态", keywordNeumorphism: "新拟物风",
                keyword3DIcons: "3D图标", keywordGradients: "渐变色", keywordAnimations: "微妙动画", keywordPlayful: "俏皮氛围",
                keywordProfessional: "专业外观", keywordFuturistic: "未来主题",
                errorOpenAI: "OpenAI API 错误", errorNetwork: "网络错误", errorUnknown: "发生未知错误", invalidColorFormat: "无效的颜色格式。",
            }
        };

        const i18nManager = {
            init() {
                this.setLanguage(state.uiLanguage);
                elements.languageDropdown.querySelectorAll('a').forEach(a => {
                    a.addEventListener('click', (e) => {
                        e.preventDefault();
                        const lang = e.target.dataset.lang;
                        this.setLanguage(lang);
                        elements.languageDropdown.classList.add('hidden');
                    });
                });
                elements.languageSelector.addEventListener('click', () => {
                    const isHidden = elements.languageDropdown.classList.toggle('hidden');
                    elements.languageSelector.setAttribute('aria-expanded', !isHidden);
                });
                document.addEventListener('click', (e) => { 
                    if (!elements.languageSelector.contains(e.target) && !elements.languageDropdown.contains(e.target)) {
                        elements.languageDropdown.classList.add('hidden');
                        elements.languageSelector.setAttribute('aria-expanded', 'false');
                    }
                });
            },
            setLanguage(lang) {
                state.uiLanguage = lang;
                localStorage.setItem('uiLanguage', lang);
                elements.currentDisplayLang.textContent = lang === 'en-US' ? 'English' : '中文';
                document.documentElement.lang = lang.startsWith('zh') ? 'zh-CN' : 'en';

                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.dataset.i18n;
                    const translation = (i18nData[lang] && i18nData[lang][key]) || (i18nData['en-US'] && i18nData['en-US'][key]) || el.innerHTML;
                    el.innerHTML = translation; 
                });
                 document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                    const key = el.dataset.i18nPlaceholder;
                    const placeholderText = (i18nData[lang] && i18nData[lang][key]) || (i18nData['en-US'] && i18nData['en-US'][key]) || el.placeholder;
                    el.placeholder = placeholderText;
                });
                historyManager.renderHistory(); 
                templateManager.renderTemplates(); 
                keywordManager.renderKeywords(); 
                openAISettingsManager.populateModelSelect([], elements.modelSelect.value); 
                selectionManager.updateAllDisplays(); 
            },
            t(key, fallback = '') { 
                return (i18nData[state.uiLanguage] && i18nData[state.uiLanguage][key]) || 
                       (i18nData['en-US'] && i18nData['en-US'][key]) || 
                       fallback || key;
            }
        };
        
        // --- Utility Functions ---
        function showToast(messageKey, type = 'success', duration = 3000, details = '') {
            let message = i18nManager.t(messageKey, messageKey);
            if (details) message += `: ${details}`;

            const toastId = 'toast-' + Date.now();
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = `fixed bottom-4 right-4 px-4 py-3 rounded-lg text-white shadow-xl z-[10000] transform transition-all duration-300 translate-y-12 opacity-0 max-w-sm`;
            toast.setAttribute('role', 'alert');
            
            let iconClass = 'fas fa-info-circle';
            if (type === 'success') { toast.classList.add('bg-green-500'); iconClass = 'fas fa-check-circle'; }
            else if (type === 'error') { toast.classList.add('bg-red-500'); iconClass = 'fas fa-times-circle'; }
            else if (type === 'warning') { toast.classList.add('bg-yellow-500'); iconClass = 'fas fa-exclamation-triangle'; }
            else { toast.classList.add('bg-blue-500'); }

            toast.innerHTML = `<i class="${iconClass} mr-2" aria-hidden="true"></i> ${message}`;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.classList.remove('translate-y-12', 'opacity-0');
                toast.classList.add('translate-y-0', 'opacity-100');
            }, 10);

            setTimeout(() => {
                toast.classList.remove('translate-y-0', 'opacity-100');
                toast.classList.add('translate-y-12', 'opacity-0');
                setTimeout(() => { 
                    const el = document.getElementById(toastId);
                    if(el) el.remove();
                }, 300);
            }, duration);
        }

        // --- Theme Manager ---
        const themeManager = {  
            init() {
                this.loadSavedTheme();
                this.bindEvents();
                this.updateIcon();
            },
            bindEvents() {
                elements.themeToggle.addEventListener('click', () => this.toggleTheme());
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                    if (!localStorage.getItem('theme')) { 
                        document.documentElement.classList.toggle('dark', e.matches);
                        state.theme = e.matches ? 'dark' : 'light';
                        this.updateIcon();
                    }
                });
            },
            toggleTheme() {
                const isDark = document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                state.theme = isDark ? 'dark' : 'light';
                this.updateIcon();
            },
            loadSavedTheme() {
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme) {
                    document.documentElement.classList.toggle('dark', savedTheme === 'dark');
                    state.theme = savedTheme;
                } else { 
                    document.documentElement.classList.toggle('dark', state.theme === 'dark');
                }
            },
            updateIcon() {
                const isDark = document.documentElement.classList.contains('dark');
                elements.themeToggle.querySelector('.fa-moon').classList.toggle('hidden', isDark);
                elements.themeToggle.querySelector('.fa-sun').classList.toggle('hidden', !isDark);
            }
        };


        // --- Wizard Manager ---
        const wizardManager = { 
            init() {
                this.bindEvents();
                this.updateProgress(state.currentStep);
            },
            bindEvents() {
                Object.entries(elements.navigationButtons).forEach(([key, button]) => {
                    if (button) button.addEventListener('click', () => this.handleNavigation(key));
                });
            },
            handleNavigation(buttonId) {
                const actions = {
                    nextStep1: () => this.moveToStep(2),
                    nextStep2: () => this.moveToStep(3),
                    nextStep3: () => this.moveToStep(4),
                    prevStep2: () => this.moveToStep(1),
                    prevStep3: () => this.moveToStep(2),
                    prevStep4: () => this.moveToStep(3)
                };
                if (actions[buttonId]) actions[buttonId]();
            },
            moveToStep(step) {
                if (elements.wizardSteps[`step${state.currentStep}`]) {
                    elements.wizardSteps[`step${state.currentStep}`].classList.add('hidden');
                }
                if (elements.wizardSteps[`step${step}`]) {
                    elements.wizardSteps[`step${step}`].classList.remove('hidden');
                    elements.wizardSteps[`step${step}`].classList.add('flip-in');
                }
                this.updateProgress(step);
                state.currentStep = step;
                window.scrollTo({ top: 0, behavior: 'smooth' });
            },
            updateProgress(step) {
                const progressPercentage = ((step - 1) / (elements.stepIndicators.length - 1)) * 100;
                elements.progressBar.style.width = `${progressPercentage}%`;
                document.querySelector('.progress-container').setAttribute('aria-valuenow', progressPercentage);


                elements.stepIndicators.forEach((indicator, index) => {
                    indicator.classList.remove('completed', 'active');
                    indicator.setAttribute('aria-current', 'false');
                    if (index < step -1) { 
                        indicator.classList.add('completed');
                    } else if (index === step - 1) { 
                        indicator.classList.add('active');
                        indicator.setAttribute('aria-current', 'step');
                    }
                });
            }
        };

        // --- Selection Manager (Handles Step 1, 2, 3 selections) ---
        const selectionManager = { 
            init() {
                this.bindEvents();
                this.updateAllDisplays();
            },
            bindEvents() {
                elements.purposeCards.forEach(card => card.addEventListener('click', () => this.handlePurposeSelection(card)));
                elements.styleCards.forEach(card => card.addEventListener('click', () => this.handleStyleSelection(card)));
                elements.industryTags.forEach(tag => tag.addEventListener('click', () => this.handleIndustrySelection(tag)));
                elements.colorSwatches.forEach(swatch => swatch.addEventListener('click', () => this.handleColorSelection(swatch)));
                
                elements.customColorInput.addEventListener('input', (e) => {
                    const newColor = e.target.value.trim();
                    if (this.isValidColor(newColor)) elements.customColorPreview.style.backgroundColor = newColor;
                });
                elements.applyCustomColor.addEventListener('click', () => {
                    const color = elements.customColorInput.value.trim();
                    if (this.isValidColor(color)) {
                        state.selections.color = color;
                        elements.customColorPreview.style.backgroundColor = color;
                        elements.colorSwatches.forEach(s => s.classList.remove('selected'));
                        this.updateSelectionDisplay('color');
                    } else {
                        showToast('invalidColorFormat', 'error'); 
                    }
                });
                elements.promptLanguageSelect.addEventListener('change', (e) => state.promptLanguage = e.target.value);
                elements.promptDetailLevelSelect.addEventListener('change', (e) => state.promptDetailLevel = e.target.value);
                elements.aspectRatioSelect.addEventListener('change', (e) => {
                    state.aspectRatio = e.target.value;
                    elements.customAspectRatioContainer.classList.toggle('hidden', e.target.value !== 'custom');
                    if (e.target.value !== 'custom') state.customAspectRatio = ''; 
                });
                elements.customAspectRatioInput.addEventListener('input', (e) => state.customAspectRatio = e.target.value);
                elements.negativePrompt.addEventListener('input', (e) => state.selections.negativePrompt = e.target.value);
            },
            isValidColor(strColor) {
                const s = new Option().style; s.color = strColor; return s.color !== '';
            },
            handlePurposeSelection(card) {
                elements.purposeCards.forEach(c => { c.classList.remove('selected'); c.setAttribute('aria-pressed', 'false'); });
                card.classList.add('selected');
                card.setAttribute('aria-pressed', 'true');
                state.selections.purpose = card.dataset.purpose;
                state.selections.purposeText = card.querySelector('p.font-medium').textContent.trim();
                this.updateSelectionDisplay('purpose');
            },
            handleStyleSelection(card) {
                elements.styleCards.forEach(c => { c.classList.remove('selected'); c.setAttribute('aria-pressed', 'false'); });
                card.classList.add('selected');
                card.setAttribute('aria-pressed', 'true');
                state.selections.style = card.dataset.style;
                this.updateSelectionDisplay('style');
            },
            handleIndustrySelection(tag) {
                elements.industryTags.forEach(t => { t.classList.remove('selected'); t.setAttribute('aria-pressed', 'false'); });
                tag.classList.add('selected');
                tag.setAttribute('aria-pressed', 'true');
                state.selections.industry = tag.dataset.industry;
                state.selections.industryText = tag.textContent.trim();
                this.updateSelectionDisplay('industry');
            },
            handleColorSelection(swatch) {
                elements.colorSwatches.forEach(s => { s.classList.remove('selected'); s.setAttribute('aria-pressed', 'false'); });
                swatch.classList.add('selected');
                swatch.setAttribute('aria-pressed', 'true');
                const color = swatch.dataset.color;
                state.selections.color = color;
                elements.customColorInput.value = color;
                elements.customColorPreview.style.backgroundColor = color;
                this.updateSelectionDisplay('color');
            },
            updateSelectionDisplay(type) {
                const s = state.selections;
                const t = i18nManager.t; 
                const displays = {
                    purpose: () => elements.selectedPurpose.innerHTML = `<i class="fas fa-bullseye mr-2 text-indigo-500 w-4 text-center" aria-hidden="true"></i> ${t('selectedPurposePrefix')}<span class="font-semibold">${s.purposeText || t('notSelected')}</span>`,
                    industry: () => elements.selectedIndustry.innerHTML = `<i class="fas fa-building mr-2 text-indigo-500 w-4 text-center" aria-hidden="true"></i> ${t('selectedIndustryPrefix')}<span class="font-semibold">${s.industryText || t('notSelected')}</span>`,
                    style: () => elements.selectedStyle.innerHTML = `<i class="fas fa-palette mr-2 text-indigo-500 w-4 text-center" aria-hidden="true"></i> ${t('selectedStylePrefix')}<span class="font-semibold">${s.style || t('notSelected')}</span>`,
                    color: () => elements.selectedColor.innerHTML = `<i class="fas fa-fill-drip mr-2 text-indigo-500 w-4 text-center" aria-hidden="true"></i> ${t('selectedColorPrefix')}<span class="font-semibold">${s.color}</span>`,
                    components: () => elements.selectedComponentsCount.innerHTML = `<i class="fas fa-cubes mr-2 text-indigo-500 w-4 text-center" aria-hidden="true"></i> ${t('selectedComponentsPrefix')}<span class="font-semibold">${s.components.length} ${t('countUnit')}</span>`
                };
                if (displays[type]) displays[type]();
            },
            updateAllDisplays() {
                ['purpose', 'industry', 'style', 'color', 'components'].forEach(type => this.updateSelectionDisplay(type));
            },
            resetAllSelections() { 
                state.selections = {
                    purpose: '', purposeText: '', industry: '', industryText: '', style: '',
                    color: '#6366F1', components: [], componentIds: [], additionalDetails: '', negativePrompt: '', templateId: null,
                };
                state.aspectRatio = ''; state.customAspectRatio = '';

                elements.purposeCards.forEach(c => { c.classList.remove('selected'); c.setAttribute('aria-pressed', 'false'); });
                elements.industryTags.forEach(t => { t.classList.remove('selected'); t.setAttribute('aria-pressed', 'false'); });
                elements.styleCards.forEach(c => { c.classList.remove('selected'); c.setAttribute('aria-pressed', 'false'); });
                elements.colorSwatches.forEach(s => { s.classList.remove('selected'); s.setAttribute('aria-pressed', 'false'); });
                const defaultColorSwatch = Array.from(elements.colorSwatches).find(s => s.dataset.color === state.selections.color);
                if (defaultColorSwatch) { defaultColorSwatch.classList.add('selected'); defaultColorSwatch.setAttribute('aria-pressed', 'true'); }
                elements.customColorInput.value = state.selections.color;
                elements.customColorPreview.style.backgroundColor = state.selections.color;
                
                elements.componentTagsElements.forEach(tag => { tag.classList.remove('selected'); tag.setAttribute('aria-checked', 'false'); });
                elements.additionalDetails.value = '';
                elements.negativePrompt.value = '';
                elements.promptLanguageSelect.value = 'en'; state.promptLanguage = 'en';
                elements.promptDetailLevelSelect.value = 'standard'; state.promptDetailLevel = 'standard';
                elements.aspectRatioSelect.value = ''; elements.customAspectRatioContainer.classList.add('hidden'); elements.customAspectRatioInput.value = '';

                this.updateAllDisplays();
                componentManager.updateComponentPreview();
                templateManager.clearTemplateSelectionVisuals();
                promptManager.toggleEditPrompt(false); 
            }
        };

        // --- Component Manager ---
        const componentManager = { 
            init() {
                this.bindEvents();
                this.filterComponents();
            },
            bindEvents() {
                elements.componentSearchInput.addEventListener('input', () => this.filterComponents());
                elements.clearSearchButton.addEventListener('click', () => {
                    elements.componentSearchInput.value = ''; this.filterComponents();
                });
                elements.categoryPillsElements.forEach(pill => {
                    pill.addEventListener('click', (e) => {
                        elements.categoryPillsElements.forEach(p => { p.classList.remove('active'); p.setAttribute('aria-selected', 'false'); });
                        e.currentTarget.classList.add('active');
                        e.currentTarget.setAttribute('aria-selected', 'true');
                        this.filterComponents(e.currentTarget.dataset.category);
                    });
                });
                elements.componentTagsElements.forEach(tag => {
                    tag.addEventListener('click', (e) => this.toggleComponent(e.currentTarget));
                    tag.addEventListener('keydown', (e) => { // Keyboard support for selection
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            this.toggleComponent(e.currentTarget);
                        }
                    });
                });
            },
            filterComponents(category = null) {
                const searchTerm = elements.componentSearchInput.value.toLowerCase().trim();
                const currentCategoryFilter = category || document.querySelector('#wizardStep3 .category-pill.active').dataset.category;

                elements.clearSearchButton.style.display = searchTerm ? 'flex' : 'none';

                elements.componentContainer.querySelectorAll('.component-section').forEach(section => {
                    const sectionCategory = section.dataset.category;
                    let sectionHasVisibleComponents = false;
                    section.querySelectorAll('.component-tag').forEach(tag => {
                        const componentText = tag.querySelector('span:last-child').textContent.toLowerCase();
                        const matchesSearch = componentText.includes(searchTerm);
                        const matchesCategory = (currentCategoryFilter === 'all' || sectionCategory === currentCategoryFilter);
                        if (matchesSearch && matchesCategory) {
                            tag.style.display = 'flex'; sectionHasVisibleComponents = true;
                        } else {
                            tag.style.display = 'none';
                        }
                    });
                    section.style.display = sectionHasVisibleComponents ? 'block' : 'none';
                });
            },
            toggleComponent(tagToToggle) { 
                if (tagToToggle) {
                    const isSelected = tagToToggle.classList.toggle('selected');
                    tagToToggle.setAttribute('aria-checked', isSelected);
                }
                
                state.selections.components = Array.from(document.querySelectorAll('#wizardStep3 .component-tag.selected'))
                    .map(t => t.querySelector('span:last-child').textContent.trim()); 
                state.selections.componentIds = Array.from(document.querySelectorAll('#wizardStep3 .component-tag.selected'))
                    .map(t => t.dataset.componentId);
                this.updateComponentPreview();
                selectionManager.updateSelectionDisplay('components');
            },
            updateComponentPreview() {
                const { previewContainer } = elements;
                if (state.selections.components.length === 0) {
                    previewContainer.innerHTML = `<div class="preview-placeholder text-center py-4"><p data-i18n="previewPlaceholderText">${i18nManager.t('previewPlaceholderText')}</p><i class="fas fa-arrow-left text-2xl mt-2" aria-hidden="true"></i></div>`;
                    return;
                }
                let previewHTML = '<div class="grid grid-cols-1 md:grid-cols-2 gap-2 custom-scrollbar" style="max-height: 200px; overflow-y: auto;">';
                state.selections.components.forEach(componentName => {
                    const originalTag = Array.from(elements.componentTagsElements).find(tag => tag.querySelector('span:last-child').textContent.trim() === componentName);
                    const iconHTML = originalTag ? originalTag.querySelector('.component-icon').innerHTML : '<i class="fas fa-cube" aria-hidden="true"></i>';
                    previewHTML += `<div class="preview-component p-2 rounded-md flex items-center text-sm bg-gray-100 dark:bg-gray-800"><span class="component-icon text-indigo-500 text-base mr-2">${iconHTML}</span><span class="truncate" title="${componentName}">${componentName}</span></div>`;
                });
                previewHTML += '</div>';
                previewContainer.innerHTML = previewHTML;
            },
            selectComponentsByIds(ids = []) {
                elements.componentTagsElements.forEach(tag => {
                    const shouldBeSelected = ids.includes(tag.dataset.componentId);
                    tag.classList.toggle('selected', shouldBeSelected);
                    tag.setAttribute('aria-checked', shouldBeSelected);
                });
                state.selections.components = Array.from(document.querySelectorAll('#wizardStep3 .component-tag.selected'))
                    .map(t => t.querySelector('span:last-child').textContent.trim());
                state.selections.componentIds = Array.from(document.querySelectorAll('#wizardStep3 .component-tag.selected'))
                    .map(t => t.dataset.componentId);
                this.updateComponentPreview();
                selectionManager.updateSelectionDisplay('components');
            }
        };
        
        // --- Template Manager ---
        const templateManager = {
            init() {
                this.renderTemplates();
            },
            renderTemplates() {
                const container = elements.templateSelectionContainer;
                if (!container) return;
                container.innerHTML = '';
                TEMPLATE_DEFINITIONS.forEach(template => {
                    const card = document.createElement('div');
                    card.className = 'template-option-card';
                    card.dataset.templateId = template.id;
                    card.tabIndex = 0;
                    card.setAttribute('role', 'button');
                    card.innerHTML = `
                        <h4 class="text-indigo-600 dark:text-indigo-400">${i18nManager.t(template.nameKey)}</h4>
                        <p class="text-xs">${i18nManager.t(template.descriptionKey)}</p>
                    `;
                    card.addEventListener('click', () => this.applyTemplate(template.id));
                    card.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            this.applyTemplate(template.id);
                        }
                    });
                    container.appendChild(card);
                });
            },
            applyTemplate(templateId) {
                const template = TEMPLATE_DEFINITIONS.find(t => t.id === templateId);
                if (!template) return;

                selectionManager.resetAllSelections(); 

                state.selections.templateId = template.id;
                if (template.style) {
                    const styleCard = Array.from(elements.styleCards).find(sc => sc.dataset.style === template.style);
                    if (styleCard) selectionManager.handleStyleSelection(styleCard);
                    else state.selections.style = template.style; 
                }
                if (template.color) {
                    state.selections.color = template.color;
                    elements.customColorInput.value = template.color;
                    elements.customColorPreview.style.backgroundColor = template.color;
                    const colorSwatch = Array.from(elements.colorSwatches).find(cs => cs.dataset.color === template.color);
                    if (colorSwatch) selectionManager.handleColorSelection(colorSwatch);
                }
                if (template.componentIds && template.componentIds.length > 0) {
                    componentManager.selectComponentsByIds(template.componentIds);
                }
                if (template.detailsKey) {
                    elements.additionalDetails.value = i18nManager.t(template.detailsKey);
                    state.selections.additionalDetails = elements.additionalDetails.value;
                }
                
                this.updateTemplateSelectionVisuals(templateId);
                selectionManager.updateAllDisplays();
                showToast('templateApplied', 'success');
            },
            updateTemplateSelectionVisuals(selectedTemplateId) {
                elements.templateSelectionContainer.querySelectorAll('.template-option-card').forEach(card => {
                    const isSelected = card.dataset.templateId === selectedTemplateId;
                    card.classList.toggle('selected', isSelected);
                    card.setAttribute('aria-pressed', isSelected);
                });
            },
            clearTemplateSelectionVisuals() {
                state.selections.templateId = null;
                elements.templateSelectionContainer.querySelectorAll('.template-option-card').forEach(card => {
                    card.classList.remove('selected');
                    card.setAttribute('aria-pressed', 'false');
                });
            }
        };

        // --- Keyword Snippets Manager ---
        const keywordManager = {
            init() {
                this.renderKeywords(); 
                elements.addCustomKeywordBtn.addEventListener('click', () => this.addCustomKeyword());
                elements.newCustomKeywordInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') { e.preventDefault(); this.addCustomKeyword(); }
                });
            },
            renderKeywords() {
                const container = elements.keywordSnippetsContainer;
                if (!container) return;
                container.innerHTML = '';
                
                KEYWORD_DEFINITIONS.forEach(keyword => {
                    const tag = document.createElement('button');
                    tag.className = 'keyword-tag';
                    tag.innerHTML = `<i class="${keyword.icon}" aria-hidden="true"></i> ${i18nManager.t(keyword.textKey)}`;
                    tag.addEventListener('click', () => this.addKeywordToDetails(i18nManager.t(keyword.textKey)));
                    container.appendChild(tag);
                });

                state.customKeywords.forEach(keywordText => {
                    const tag = document.createElement('button');
                    tag.className = 'keyword-tag'; 
                    tag.innerHTML = `<i class="fas fa-star text-yellow-500" aria-hidden="true"></i> ${keywordText}`; 
                    tag.addEventListener('click', () => this.addKeywordToDetails(keywordText));
                    container.appendChild(tag);
                });
            },
            addKeywordToDetails(keywordText) {
                const currentDetails = elements.additionalDetails.value;
                if (currentDetails.toLowerCase().includes(keywordText.toLowerCase())) { 
                    showToast('keywordAlreadyAdded', 'warning');
                    return;
                }
                elements.additionalDetails.value = currentDetails ? `${currentDetails}, ${keywordText}` : keywordText;
                state.selections.additionalDetails = elements.additionalDetails.value; 
            },
            renderCustomKeywordsList() { 
                const listContainer = elements.customKeywordsList;
                listContainer.innerHTML = '';
                if (state.customKeywords.length === 0) {
                    listContainer.innerHTML = `<p class="text-xs text-gray-500" data-i18n="noCustomKeywords">${i18nManager.t('noCustomKeywords')}</p>`;
                    return;
                }
                state.customKeywords.forEach((keyword, index) => {
                    const item = document.createElement('div');
                    item.className = 'custom-keyword-item flex items-center';
                    item.innerHTML = `
                        <span class="flex-grow">${keyword}</span>
                        <button data-index="${index}" class="remove-custom-keyword-btn" aria-label="${i18nManager.t('removeButton')} ${keyword}">
                            <i class="fas fa-trash-alt" aria-hidden="true"></i>
                        </button>
                    `;
                    item.querySelector('.remove-custom-keyword-btn').addEventListener('click', (e) => {
                        this.removeCustomKeyword(parseInt(e.currentTarget.dataset.index));
                    });
                    listContainer.appendChild(item);
                });
            },
            addCustomKeyword() {
                const newKeyword = elements.newCustomKeywordInput.value.trim();
                if (!newKeyword) return;
                if (state.customKeywords.map(k => k.toLowerCase()).includes(newKeyword.toLowerCase())) {
                    showToast('customKeywordExists', 'warning');
                    return;
                }
                state.customKeywords.push(newKeyword);
                localStorage.setItem('customKeywords_v1.2', JSON.stringify(state.customKeywords));
                this.renderCustomKeywordsList();
                this.renderKeywords(); 
                elements.newCustomKeywordInput.value = '';
                showToast('customKeywordAdded', 'success');
            },
            removeCustomKeyword(index) {
                state.customKeywords.splice(index, 1);
                localStorage.setItem('customKeywords_v1.2', JSON.stringify(state.customKeywords));
                this.renderCustomKeywordsList();
                this.renderKeywords(); 
                showToast('customKeywordRemoved', 'info');
            }
        };

        // --- Prompt History Manager ---
        const historyManager = { 
            MAX_HISTORY_ITEMS: 20, 
            init() {
                this.renderHistory();
                elements.clearHistoryBtn.addEventListener('click', () => this.clearHistory());
                elements.historySearchInput.addEventListener('input', () => this.renderHistory());
            },
            renderHistory() {
                const container = elements.promptHistoryContainer;
                container.innerHTML = '';
                const searchTerm = elements.historySearchInput.value.toLowerCase().trim();
                
                const filteredHistory = state.promptHistory.filter(item => 
                    item.prompt.toLowerCase().includes(searchTerm) ||
                    new Date(item.timestamp).toLocaleString(state.uiLanguage.replace('_','-')).toLowerCase().includes(searchTerm)
                );

                if (filteredHistory.length === 0) {
                    container.innerHTML = `<p class="text-sm text-gray-500 text-center py-4" data-i18n="noHistory">${i18nManager.t('noHistory')}</p>`;
                    return;
                }
                filteredHistory.slice().reverse().forEach((item) => { 
                    const originalIndex = state.promptHistory.findIndex(hItem => hItem.timestamp === item.timestamp && hItem.prompt === item.prompt);

                    const div = document.createElement('div');
                    div.className = 'history-item flex justify-between items-center';
                    div.innerHTML = `
                        <div class="truncate pr-2">
                            <span class="block truncate" title="${item.prompt}">${item.prompt.substring(0, 60)}${item.prompt.length > 60 ? '...' : ''}</span>
                            <span class="timestamp">${new Date(item.timestamp).toLocaleString(state.uiLanguage.replace('_','-'))} (${i18nManager.t(item.lang === 'zh' ? 'langChinese' : 'langEnglish')})</span>
                        </div>
                        <div class="history-item-actions flex-shrink-0">
                            <button data-index="${originalIndex}" class="load-history-btn tooltip" aria-label="${i18nManager.t('loadTooltip')}"><i class="fas fa-redo-alt" aria-hidden="true"></i><span class="tooltip-text">${i18nManager.t('loadTooltip')}</span></button>
                            <button data-index="${originalIndex}" class="copy-history-btn tooltip" aria-label="${i18nManager.t('copyTooltip')}"><i class="fas fa-copy" aria-hidden="true"></i><span class="tooltip-text">${i18nManager.t('copyTooltip')}</span></button>
                        </div>
                    `;
                    container.appendChild(div);
                });
                container.querySelectorAll('.load-history-btn').forEach(btn => btn.addEventListener('click', (e) => this.loadFromHistory(parseInt(e.currentTarget.dataset.index))));
                container.querySelectorAll('.copy-history-btn').forEach(btn => btn.addEventListener('click', (e) => this.copyFromHistory(parseInt(e.currentTarget.dataset.index))));
            },
            addHistory(prompt, selectionsSnapshot, lang, detailLevel, aspectRatio, customAspectRatio, negativePrompt) {
                const newItem = { 
                    prompt, 
                    selections: JSON.parse(JSON.stringify(selectionsSnapshot)), 
                    lang,
                    detailLevel,
                    aspectRatio, customAspectRatio, negativePrompt, 
                    timestamp: Date.now() 
                };
                state.promptHistory.push(newItem);
                if (state.promptHistory.length > this.MAX_HISTORY_ITEMS) {
                    state.promptHistory.shift(); 
                }
                localStorage.setItem('promptHistory_v1.2', JSON.stringify(state.promptHistory));
                this.renderHistory();
            },
            clearHistory() {
                if (confirm(i18nManager.t('confirmClearHistory'))) {
                    state.promptHistory = [];
                    localStorage.removeItem('promptHistory_v1.2');
                    this.renderHistory();
                    showToast('historyCleared', 'info');
                }
            },
            loadFromHistory(index) {
                const item = state.promptHistory[index];
                if (!item) return;

                selectionManager.resetAllSelections(); 

                state.selections = JSON.parse(JSON.stringify(item.selections)); 
                elements.additionalDetails.value = state.selections.additionalDetails || '';
                elements.negativePrompt.value = item.negativePrompt || ''; state.selections.negativePrompt = item.negativePrompt || '';
                elements.promptLanguageSelect.value = item.lang || 'en'; state.promptLanguage = item.lang || 'en';
                elements.promptDetailLevelSelect.value = item.detailLevel || 'standard'; state.promptDetailLevel = item.detailLevel || 'standard';
                elements.aspectRatioSelect.value = item.aspectRatio || ''; state.aspectRatio = item.aspectRatio || '';
                elements.customAspectRatioInput.value = item.customAspectRatio || ''; state.customAspectRatio = item.customAspectRatio || '';
                elements.customAspectRatioContainer.classList.toggle('hidden', state.aspectRatio !== 'custom');
                
                if (state.selections.purpose) {
                    const card = Array.from(elements.purposeCards).find(c => c.dataset.purpose === state.selections.purpose);
                    if (card) { card.classList.add('selected'); card.setAttribute('aria-pressed', 'true'); }
                }
                if (state.selections.industry) {
                    const tag = Array.from(elements.industryTags).find(t => t.dataset.industry === state.selections.industry);
                    if (tag) { tag.classList.add('selected'); tag.setAttribute('aria-pressed', 'true'); }
                }
                if (state.selections.style) {
                    const card = Array.from(elements.styleCards).find(s => s.dataset.style === state.selections.style);
                    if (card) { card.classList.add('selected'); card.setAttribute('aria-pressed', 'true'); }
                }
                if (state.selections.color) {
                    const swatch = Array.from(elements.colorSwatches).find(cs => cs.dataset.color === state.selections.color);
                    if (swatch) { swatch.classList.add('selected'); swatch.setAttribute('aria-pressed', 'true'); }
                    else elements.colorSwatches.forEach(s => s.classList.remove('selected'));
                    elements.customColorInput.value = state.selections.color;
                    elements.customColorPreview.style.backgroundColor = state.selections.color;
                }
                
                if (state.selections.componentIds && state.selections.componentIds.length > 0) {
                    componentManager.selectComponentsByIds(state.selections.componentIds);
                } else {
                    componentManager.selectComponentsByIds([]); 
                }

                if (state.selections.templateId) {
                    templateManager.updateTemplateSelectionVisuals(state.selections.templateId);
                } else {
                    templateManager.clearTemplateSelectionVisuals();
                }

                elements.generatedPrompt.value = item.prompt; 
                promptManager.toggleEditPrompt(false); 
                selectionManager.updateAllDisplays();
                wizardManager.moveToStep(4); 
                showToast('historyLoaded', 'success');
            },
            async copyFromHistory(index) {
                const item = state.promptHistory[index];
                if (!item || !item.prompt) return;
                try {
                    await navigator.clipboard.writeText(item.prompt);
                    showToast('promptCopied', 'success');
                } catch (err) {
                    showToast('copyFailed', 'error');
                }
            }
        };

        // --- OpenAI Settings Manager ---
        const openAISettingsManager = { 
            defaultSettings: { apiKey: '', baseUrl: 'https://api.openai.com/v1', model: 'gpt-4o' },
            init() { 
                this.loadSettings(); 
                this.bindEvents(); 
                this.setupTabs();
            },
            bindEvents() {
                elements.settingsButton.addEventListener('click', () => { 
                    elements.settingsModal.classList.add('show'); 
                    document.body.style.overflow = 'hidden';
                    keywordManager.renderCustomKeywordsList(); 
                    if (elements.apiKeyInput.value.trim()) {
                        this.fetchAvailableModels(false); 
                    }
                });
                elements.closeSettingsModal.addEventListener('click', () => this.closeModal());
                elements.settingsModal.addEventListener('click', (e) => { if (e.target === elements.settingsModal) this.closeModal(); });
                elements.modelSelect.addEventListener('change', () => {
                    elements.customModelContainer.classList.toggle('hidden', elements.modelSelect.value !== 'custom');
                });
                elements.apiKeyInput.addEventListener('blur', () => { 
                    if (elements.apiKeyInput.value.trim()) {
                        this.fetchAvailableModels(true); 
                    }
                });
                elements.saveSettingsButton.addEventListener('click', async () => {
                    const btn = elements.saveSettingsButton;
                    const originalText = btn.textContent;
                    btn.textContent = i18nManager.t('saving'); btn.disabled = true;
                    this.saveSettings();
                    await new Promise(r => setTimeout(r, 300));
                    showToast('settingsSaved', 'success');
                    setTimeout(() => { this.closeModal(); btn.textContent = originalText; btn.disabled = false; }, 500);
                });
                elements.resetSettingsButton.addEventListener('click', () => { this.resetSettings(); showToast('settingsReset', 'info'); });
                if (elements.fetchModelsButton) {
                    elements.fetchModelsButton.addEventListener('click', async () => await this.fetchAvailableModels(true));
                }
            },
            setupTabs() {
                elements.settingsTabButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        const tabId = e.currentTarget.dataset.tab;
                        elements.settingsTabButtons.forEach(btn => { btn.classList.remove('active'); btn.setAttribute('aria-selected', 'false'); });
                        elements.settingsTabContents.forEach(content => content.classList.remove('active'));
                        e.currentTarget.classList.add('active');
                        e.currentTarget.setAttribute('aria-selected', 'true');
                        document.getElementById(tabId).classList.add('active');
                    });
                });
            },
            closeModal() { elements.settingsModal.classList.remove('show'); document.body.style.overflow = ''; },
            loadSettings() {
                try {
                    const saved = localStorage.getItem('openai_settings_v1.2'); 
                    const settings = saved ? JSON.parse(saved) : { ...this.defaultSettings };
                    elements.apiKeyInput.value = settings.apiKey || '';
                    elements.baseUrlInput.value = settings.baseUrl || this.defaultSettings.baseUrl;
                    this.populateModelSelect([], settings.model); 
                } catch (e) { this.resetSettings(); }
            },
            saveSettings() {
                let model = elements.modelSelect.value;
                if (model === 'custom') model = elements.customModelInput.value.trim() || this.defaultSettings.model;
                const settings = { apiKey: elements.apiKeyInput.value.trim(), baseUrl: elements.baseUrlInput.value.trim() || this.defaultSettings.baseUrl, model };
                localStorage.setItem('openai_settings_v1.2', JSON.stringify(settings));
            },
            resetSettings() {
                elements.apiKeyInput.value = this.defaultSettings.apiKey;
                elements.baseUrlInput.value = this.defaultSettings.baseUrl;
                this.populateModelSelect([], this.defaultSettings.model); 
                elements.customModelInput.value = '';
                elements.customModelContainer.classList.add('hidden');
                localStorage.setItem('openai_settings_v1.2', JSON.stringify(this.defaultSettings));
                state.customKeywords = [];
                localStorage.removeItem('customKeywords_v1.2');
                keywordManager.renderCustomKeywordsList();
                keywordManager.renderKeywords();
            },
            getSettings() {
                const saved = localStorage.getItem('openai_settings_v1.2');
                return saved ? JSON.parse(saved) : { ...this.defaultSettings };
            },
            async fetchAvailableModels(showSuccessToast = true) {
                const apiKey = elements.apiKeyInput.value.trim();
                const baseUrl = elements.baseUrlInput.value.trim() || this.defaultSettings.baseUrl;
                if (!apiKey) { if(showSuccessToast) showToast('apiKeyRequiredForModels', 'warning'); return; } 
                const endpoint = `${baseUrl.replace(/\/$/, '')}/models`;
                const icon = elements.fetchModelsButton.querySelector('i');
                icon.classList.add('fa-spin'); elements.fetchModelsButton.disabled = true;
                try {
                    const resp = await fetch(endpoint, { headers: { 'Authorization': `Bearer ${apiKey}` } });
                    if (!resp.ok) { 
                        const errData = await resp.json().catch(() => ({})); 
                        const message = errData.error?.message || resp.statusText;
                        throw new Error(`(${resp.status}) ${message}`); 
                    }
                    const data = await resp.json();
                    if (data && data.data && Array.isArray(data.data)) {
                        this.populateModelSelect(data.data, elements.modelSelect.value); 
                        if(showSuccessToast) showToast('modelsFetched', 'success');
                    } else { throw new Error(i18nManager.t('invalidModelData')); }
                } catch (e) { 
                    showToast(i18nManager.t('fetchModelsError'), 'error', 5000, e.message); 
                }
                finally { icon.classList.remove('fa-spin'); elements.fetchModelsButton.disabled = false; }
            },
            populateModelSelect(apiModels = [], currentSelection = null) {
                const select = elements.modelSelect;
                const customModelVal = elements.customModelInput.value.trim();
                
                const defaultModelOptions = [ 
                    { id: "gpt-4o", nameKey: "modelGpt4o" }, { id: "gpt-4-turbo", nameKey: "modelGpt4Turbo" },
                    { id: "gpt-3.5-turbo", nameKey: "modelGpt35Turbo" }, { id: "claude-3-5-sonnet-20240620", nameKey: "modelClaude35" },
                    { id: "deepseek-chat", nameKey: "modelDeepseek" },
                ];

                const allModels = new Map();
                defaultModelOptions.forEach(m => allModels.set(m.id, i18nManager.t(m.nameKey)));
                
                const chatModelPrefixes = ['gpt-', 'claude-', 'deepseek-', 'gemini-', 'command-'];
                apiModels.filter(m => chatModelPrefixes.some(p => m.id.startsWith(p)) && !m.id.includes('instruct') && !m.id.includes('vision') && !m.id.includes('embedding'))
                         .forEach(m => allModels.set(m.id, m.id)); 

                select.innerHTML = ''; 
                allModels.forEach((name, id) => {
                    const opt = document.createElement('option');
                    opt.value = id; opt.textContent = name;
                    select.appendChild(opt);
                });
                const customOpt = document.createElement('option');
                customOpt.value = 'custom'; customOpt.textContent = i18nManager.t('modelCustom');
                select.appendChild(customOpt);

                if (currentSelection && allModels.has(currentSelection)) {
                    select.value = currentSelection;
                } else if (currentSelection === 'custom' && customModelVal) {
                    select.value = 'custom';
                    elements.customModelInput.value = customModelVal;
                } else if (allModels.has(this.defaultSettings.model)) {
                    select.value = this.defaultSettings.model; 
                } else if (allModels.size > 0) {
                    select.value = allModels.keys().next().value; 
                } else {
                     select.value = 'custom'; 
                }
                elements.customModelContainer.classList.toggle('hidden', select.value !== 'custom');
            }
        };

        // --- Prompt Manager ---
        const promptManager = { 
            init() { 
                this.bindEvents(); 
            },
            bindEvents() {
                elements.generatePromptButton.addEventListener('click', () => { if (!state.isGeneratingPrompt) this.generatePrompt(); });
                elements.copyPromptBtn.addEventListener('click', () => this.copyPrompt());
                elements.additionalDetails.addEventListener('input', (e) => state.selections.additionalDetails = e.target.value);
                elements.editPromptBtn.addEventListener('click', () => this.toggleEditPrompt());
                elements.generateVariationsBtn.addEventListener('click', () => this.generateVariations(elements.generatedPrompt.value));
                elements.generateVariationsFromEditedBtn.addEventListener('click', () => this.generateVariations(elements.generatedPrompt.value));
            },
            toggleButtonLoading(isLoading, button = elements.generatePromptButton, textKeyBase = 'generate') {
                const textEl = button.querySelector('.button-text') || button;
                const spinnerEl = button.querySelector('.loading-spinner');
                
                if (button === elements.generatePromptButton) state.isGeneratingPrompt = isLoading;
                button.disabled = isLoading;
                button.classList.toggle('disabled', isLoading);

                textEl.textContent = i18nManager.t(isLoading ? `${textKeyBase}ingButton` : `${textKeyBase}Button`);
                if(spinnerEl) spinnerEl.classList.toggle('hidden', !isLoading);
            },
            toggleEditPrompt(forceState = null) {
                state.isEditingPrompt = forceState !== null ? forceState : !state.isEditingPrompt;
                elements.generatedPrompt.readOnly = !state.isEditingPrompt;
                elements.generatedPrompt.classList.toggle('border-indigo-500', state.isEditingPrompt);
                elements.generatedPrompt.classList.toggle('dark:border-indigo-500', state.isEditingPrompt);
                elements.generatedPrompt.classList.toggle('bg-white', state.isEditingPrompt);
                elements.generatedPrompt.classList.toggle('dark:bg-gray-900', state.isEditingPrompt);


                const editBtnText = elements.editPromptBtn.querySelector('span');
                const editBtnIcon = elements.editPromptBtn.querySelector('i');

                if (state.isEditingPrompt) {
                    editBtnText.textContent = i18nManager.t('saveButton');
                    editBtnIcon.className = 'fas fa-save mr-1';
                    elements.generateVariationsFromEditedBtn.classList.remove('hidden');
                    elements.generateVariationsBtn.classList.add('hidden');
                    elements.generatePromptButton.disabled = true; 
                    elements.generatedPrompt.focus();
                } else {
                    editBtnText.textContent = i18nManager.t('editButton');
                    editBtnIcon.className = 'fas fa-edit mr-1';
                    elements.generateVariationsFromEditedBtn.classList.add('hidden');
                    const currentPrompt = elements.generatedPrompt.value;
                    const nonActionableMessages = [i18nManager.t('clickGeneratePrompt'), i18nManager.t('generatingPromptText'), i18nManager.t('enhancingPromptText'), i18nManager.t('generatingBasePromptText')];
                    if (currentPrompt && !nonActionableMessages.some(msg => currentPrompt.includes(msg))) {
                        elements.generateVariationsBtn.classList.remove('hidden');
                    }
                    elements.generatePromptButton.disabled = false;
                }
            },
            async generatePrompt(isVariationSource = false) { 
                this.toggleButtonLoading(true);
                if (state.isEditingPrompt) this.toggleEditPrompt(false); 
                
                elements.generatedPrompt.value = i18nManager.t('generatingPromptText');
                elements.aiProgressBar.style.width = '0%';
                elements.aiProgressBar.classList.remove('no-anim');
                elements.generateVariationsBtn.classList.add('hidden'); 
                elements.generateVariationsFromEditedBtn.classList.add('hidden');
                elements.variationControlsContainer.classList.add('hidden');
                elements.promptVariationsContainer.innerHTML = ''; 

                await new Promise(r => setTimeout(r, 100)); elements.aiProgressBar.style.width = '10%';
                const basePrompt = this.buildBasePrompt();
                const settings = openAISettingsManager.getSettings();
                await new Promise(r => setTimeout(r, 200)); elements.aiProgressBar.style.width = '30%';

                let finalPrompt = basePrompt;
                if (settings.apiKey && settings.apiKey.trim() !== '') {
                    elements.generatedPrompt.value = i18nManager.t('enhancingPromptText');
                    await new Promise(r => setTimeout(r, 200)); elements.aiProgressBar.style.width = '60%';
                    try {
                        finalPrompt = await this.enhancePromptWithLLM(basePrompt, settings, state.promptLanguage, state.promptDetailLevel);
                        if (!isVariationSource) showToast('promptEnhancedByAI', 'success');
                    } catch (e) {
                        console.error("LLM Error:", e);
                        finalPrompt = basePrompt + `\n\n(${i18nManager.t('aiEnhancementFailed')}: ${e.message})`;
                        if (!isVariationSource) showToast(i18nManager.t('aiEnhancementFailed'), 'error', 5000, e.message);
                    }
                } else {
                    elements.generatedPrompt.value = i18nManager.t('generatingBasePromptText');
                    await new Promise(r => setTimeout(r, 300));
                    if (!isVariationSource) showToast('apiKeyNotConfiguredBasePrompt', 'warning');
                }
                elements.generatedPrompt.value = finalPrompt; 
                elements.aiProgressBar.style.width = '100%';
                elements.aiProgressBar.classList.add('no-anim');
                this.toggleButtonLoading(false);
                
                if (!isVariationSource) { 
                    historyManager.addHistory(finalPrompt, state.selections, state.promptLanguage, state.promptDetailLevel, state.aspectRatio, state.customAspectRatio, state.selections.negativePrompt);
                    if (settings.apiKey && settings.apiKey.trim() !== '') { 
                        elements.generateVariationsBtn.classList.remove('hidden');
                        elements.variationControlsContainer.classList.remove('hidden');
                    }
                }
                return finalPrompt; 
            },
            buildBasePrompt() {
                const { purposeText, industryText, style, color, components, additionalDetails, negativePrompt } = state.selections;
                const lang = state.promptLanguage;
                const detail = state.promptDetailLevel;
                let aspectRatioString = '';
                if (state.aspectRatio === 'custom' && state.customAspectRatio) {
                    aspectRatioString = state.customAspectRatio;
                } else if (state.aspectRatio) {
                    aspectRatioString = state.aspectRatio;
                }

                let componentsString, additionalDetailsString, negativePromptString, intro, ensurePoints, outro, aspectRatioPart;

                if (lang === 'zh') {
                    componentsString = components.length > 0 ? `包含以下UI组件：${components.join('、')}。` : '组件方面没有特定要求。';
                    additionalDetailsString = additionalDetails ? `额外细节和要求：${additionalDetails}。` : '';
                    negativePromptString = negativePrompt ? `请避免以下内容：${negativePrompt}。` : '';
                    aspectRatioPart = aspectRatioString ? `图片或屏幕比例：${aspectRatioString}。` : '';
                    intro = `请为我设计一个用于“${purposeText || '通用目的'}”的UI界面。\n行业背景：“${industryText || '通用行业'}”。\n设计风格：偏向“${style || '现代简约'}”风格。\n主题色调：主要采用“${color || '#6366F1'}”作为主色调，搭配和谐的辅助色。`;
                    ensurePoints = `\n请确保最终的UI设计：\n1. 视觉上现代、专业且吸引用户。\n2. 具有优秀的用户体验和直观的导航。\n3. 响应式设计，适应不同设备屏幕。\n4. 信息架构清晰，内容易于理解。\n5. 界面元素间距恰当，留白舒适。`;
                    outro = `\n请提供一个${detail === 'concise' ? '简洁的' : detail === 'detailed' ? '非常详细的、包含具体元素描述和布局建议的' : '标准的、可操作的'}UI设计提示词，可以直接用于AI工具生成高质量的UI设计稿。提示词应具体描述页面布局、关键元素、视觉风格、色彩方案和整体氛围。`;
                } else { 
                    componentsString = components.length > 0 ? `Include the following UI components: ${components.join(', ')}.` : 'No specific component requirements.';
                    additionalDetailsString = additionalDetails ? `Additional details and requirements: ${additionalDetails}.` : '';
                    negativePromptString = negativePrompt ? `Avoid the following: ${negativePrompt}.` : '';
                    aspectRatioPart = aspectRatioString ? `Image or screen aspect ratio: ${aspectRatioString}.` : '';
                    intro = `Design a UI interface for "${purposeText || 'a general purpose application'}".\nIndustry context: "${industryText || 'a general industry'}".\nDesign style: Lean towards a "${style || 'modern minimalist'}" style.\nColor palette: Primarily use "${color || '#6366F1'}" as the main color, complemented by harmonious accent colors.`;
                    ensurePoints = `\nEnsure the final UI design is:\n1. Visually modern, professional, and engaging.\n2. Features an excellent user experience and intuitive navigation.\n3. Responsive design, adaptable to various device screens.\n4. Clear information architecture and easily understandable content.\n5. Appropriate spacing and comfortable white space.`;
                    outro = `\nPlease provide a ${detail === 'concise' ? 'concise' : detail === 'detailed' ? 'very detailed, including specific element descriptions and layout suggestions,' : 'standard, actionable'} UI design prompt suitable for AI tools to produce high-quality UI mockups. The prompt should specify page layout, key elements, visual style, color scheme, and overall atmosphere.`;
                }
                return `${intro}\n${componentsString}\n${aspectRatioPart ? aspectRatioPart + '\n' : ''}${additionalDetailsString}\n${negativePromptString}${ensurePoints}${outro}`;
            },
            async enhancePromptWithLLM(basePrompt, settings, lang, detail, instructionOverride = null) { 
                const { apiKey, baseUrl, model } = settings;
                const endpoint = `${baseUrl.replace(/\/$/, '')}/chat/completions`;
                let systemMessage = instructionOverride;

                if (!systemMessage) { 
                    if (lang === 'zh') {
                        systemMessage = `你是一个专业的UI/UX设计提示词工程师。你的任务是接收一个基础的UI设计需求描述，然后将其优化和扩展成一个${detail === 'concise' ? '简洁的' : detail === 'detailed' ? '非常详细的、富有想象力的' : '标准的'}、具体、富有创意且可操作的AI绘图提示词。最终返回的优化后提示词必须是【中文】。请直接返回优化后的中文提示词文本，不要包含任何解释、介绍或markdown格式。`;
                    } else { 
                        systemMessage = `You are a professional UI/UX design prompt engineer. Your task is to take a basic UI design requirement description and optimize and expand it into a ${detail === 'concise' ? 'concise' : detail === 'detailed' ? 'highly detailed and imaginative' : 'standard'}, specific, creative, and actionable AI art prompt. The final optimized prompt must be in **English**. Directly return the optimized English prompt text without any explanations, introductions, or markdown formatting.`;
                    }
                }

                const requestData = { model, messages: [{ role: "system", content: systemMessage }, { role: "user", content: basePrompt }], temperature: 0.7 };
                const response = await fetch(endpoint, { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` }, body: JSON.stringify(requestData) });
                if (!response.ok) { 
                    const errData = await response.json().catch(() => ({ error: { message: response.statusText, type: 'unknown_error' } }));
                    const errorType = errData.error?.type || 'unknown_error';
                    let errorMessage = errData.error?.message || response.statusText;
                    
                    if (response.status === 401) errorMessage = "Invalid API Key or Authentication Failed.";
                    else if (response.status === 429) errorMessage = "Rate limit exceeded or quota reached. Please check your OpenAI account.";
                    else if (response.status === 400 && errorMessage.includes("model_not_found")) errorMessage = `Model '${model}' not found or not accessible with your API key.`;
                    
                    throw new Error(`${i18nManager.t('errorOpenAI')} (${response.status} ${errorType}): ${errorMessage}`); 
                }
                const data = await response.json();
                if (data.choices && data.choices[0].message) return data.choices[0].message.content.trim();
                throw new Error(i18nManager.t('invalidApiResponse'));
            },
            async generateVariations(sourcePromptText) {
                if (!sourcePromptText || sourcePromptText.startsWith(i18nManager.t('clickGeneratePrompt'))) {
                    showToast('generateMainPromptFirst', 'warning'); 
                    return;
                }

                const generateButton = state.isEditingPrompt ? elements.generateVariationsFromEditedBtn : elements.generateVariationsBtn;
                this.toggleButtonLoading(true, generateButton, 'generateVariations');
                elements.promptVariationsContainer.innerHTML = `<p class="text-sm text-center py-2">${i18nManager.t('generatingVariationsText')}</p>`; 

                const settings = openAISettingsManager.getSettings();
                const lang = state.promptLanguage;
                const numVariations = parseInt(elements.numVariationsInput.value) || 3;
                const variationDegree = elements.variationDegreeSelect.value; 
                let instruction;

                let degreeInstructionPart = "";
                if (lang === 'zh') {
                    if (variationDegree === 'subtle') degreeInstructionPart = "进行细微调整，保持核心概念不变。";
                    else if (variationDegree === 'creative') degreeInstructionPart = "进行有创意的发挥，可以适度改变风格或侧重点。";
                    else if (variationDegree === 'diverse') degreeInstructionPart = "探索更多样化的可能性，可以尝试较大差异的风格、布局或主题。";
                    instruction = `基于以下UI设计提示词，为其生成${numVariations}个略有不同的中文变体。${degreeInstructionPart}每个变体应探索一种新的可能性。直接返回每个变体提示词，用"---变体分割线---"分隔。不要添加任何其他解释。`;
                } else {
                    if (variationDegree === 'subtle') degreeInstructionPart = "Make subtle adjustments, keeping the core concept intact.";
                    else if (variationDegree === 'creative') degreeInstructionPart = "Apply creative exploration, moderately changing style or emphasis.";
                    else if (variationDegree === 'diverse') degreeInstructionPart = "Explore diverse possibilities, trying significantly different styles, layouts, or themes.";
                    instruction = `Based on the following UI design prompt, generate ${numVariations} slightly different variations in English. ${degreeInstructionPart} Each variation should explore a new possibility. Return each prompt variation directly, separated by "---VARIATION_SEPARATOR---". Do not add any other explanations.`;
                }
                
                try {
                    const variationsResponse = await this.enhancePromptWithLLM(sourcePromptText, settings, lang, 'standard', instruction);
                    const separator = lang === 'zh' ? "---变体分割线---" : "---VARIATION_SEPARATOR---";
                    const variationsArray = variationsResponse.split(separator).map(v => v.trim()).filter(v => v);
                    
                    elements.promptVariationsContainer.innerHTML = ''; 
                    if (variationsArray.length > 0) {
                        variationsArray.forEach((varText, index) => {
                            const cardId = `variation-card-${Date.now()}-${index}`;
                            state.variationCardStates[cardId] = { isEditing: false };

                            const variationEl = document.createElement('div');
                            variationEl.className = 'variation-card';
                            variationEl.id = cardId;
                            variationEl.innerHTML = `
                                <textarea class="custom-scrollbar" readonly aria-label="变体提示词 ${index + 1}">${varText}</textarea>
                                <div class="variation-actions">
                                    <button class="edit-variation-btn" aria-label="编辑变体 ${index + 1}" title="${i18nManager.t('editButton')}">
                                        <i class="fas fa-edit" aria-hidden="true"></i>
                                    </button>
                                    <button class="copy-variation-btn" aria-label="复制变体 ${index + 1}" title="${i18nManager.t('copyTooltip')}">
                                        <i class="fas fa-copy" aria-hidden="true"></i>
                                    </button>
                                </div>`;
                            
                            const textarea = variationEl.querySelector('textarea');
                            const editBtn = variationEl.querySelector('.edit-variation-btn');
                            const editBtnIcon = editBtn.querySelector('i');
                            const copyBtn = variationEl.querySelector('.copy-variation-btn');

                            editBtn.addEventListener('click', () => {
                                state.variationCardStates[cardId].isEditing = !state.variationCardStates[cardId].isEditing;
                                textarea.readOnly = !state.variationCardStates[cardId].isEditing;
                                if (state.variationCardStates[cardId].isEditing) {
                                    editBtnIcon.className = 'fas fa-save';
                                    editBtn.title = i18nManager.t('saveButton');
                                    textarea.focus();
                                } else {
                                    editBtnIcon.className = 'fas fa-edit';
                                    editBtn.title = i18nManager.t('editButton');
                                    // Potentially save the edited text if needed for other features
                                }
                            });

                            copyBtn.addEventListener('click', async () => {
                                try { await navigator.clipboard.writeText(textarea.value); showToast('promptCopied', 'success'); } 
                                catch (e) { showToast('copyFailed', 'error');}
                            });
                            elements.promptVariationsContainer.appendChild(variationEl);
                        });
                        showToast('variationsGenerated', 'success');
                    } else {
                        elements.promptVariationsContainer.innerHTML = `<p class="text-sm text-center py-2">${i18nManager.t('noVariationsGenerated')}</p>`; 
                    }
                } catch (error) {
                    console.error("Error generating variations:", error);
                    elements.promptVariationsContainer.innerHTML = `<p class="text-sm text-red-500 text-center py-2">${i18nManager.t('errorGeneratingVariations')}: ${error.message}</p>`;
                    showToast(i18nManager.t('errorGeneratingVariations'), 'error', 5000, error.message);
                } finally {
                    this.toggleButtonLoading(false, generateButton, 'generateVariations');
                }
            },
            async copyPrompt() { 
                const promptText = elements.generatedPrompt.value; 
                const nonCopyableMessages = [i18nManager.t('clickGeneratePrompt'), i18nManager.t('generatingPromptText'), i18nManager.t('enhancingPromptText'), i18nManager.t('generatingBasePromptText')];
                if (!promptText || nonCopyableMessages.some(msg => promptText.includes(msg))) { showToast('nothingToCopy', 'warning'); return; }
                if (state.isCopyAnimationRunning) return;
                try {
                    await navigator.clipboard.writeText(promptText); this.showCopyFeedback(true);
                } catch (err) { this.showCopyFeedback(false); showToast('copyFailed', 'error'); }
            },
            showCopyFeedback(success) {
                state.isCopyAnimationRunning = true;
                elements.copyStatus.textContent = i18nManager.t(success ? 'copySuccess' : 'copyFailStatus');
                elements.copyStatus.className = `absolute top-2 right-12 text-sm font-medium transition-opacity ${success ? 'text-green-500' : 'text-red-500'}`;
                elements.copyStatus.classList.remove('opacity-0'); elements.copyStatus.classList.add('fade-in-out');
                elements.copyPromptBtn.classList.add('copy-animation');
                setTimeout(() => {
                    elements.copyStatus.classList.add('opacity-0'); elements.copyStatus.classList.remove('fade-in-out');
                    elements.copyPromptBtn.classList.remove('copy-animation'); state.isCopyAnimationRunning = false;
                }, 1500);
            }
        };


        // --- Config Import/Export Manager ---
        const configManager = {
            init() {
                elements.exportConfigBtn.addEventListener('click', () => this.exportConfig());
                elements.importConfigFile.addEventListener('change', (e) => this.importConfig(e));
            },
            exportConfig() {
                const config = {
                    version: "1.2", 
                    timestamp: Date.now(),
                    selections: state.selections,
                    promptLanguage: state.promptLanguage,
                    promptDetailLevel: state.promptDetailLevel,
                    aspectRatio: state.aspectRatio,
                    customAspectRatio: state.customAspectRatio,
                    openaiSettings: openAISettingsManager.getSettings(),
                    customKeywords: state.customKeywords,
                    uiLanguage: state.uiLanguage,
                    theme: state.theme
                };
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(config, null, 2));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", `ai_ui_prompt_config_v1.2_${new Date().toISOString().slice(0,10)}.json`);
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
                showToast('configExported', 'success');
            },
            importConfig(event) {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const config = JSON.parse(e.target.result);
                        if (!config.version || (config.version !== "1.1" && config.version !== "1.2")) { 
                            throw new Error(i18nManager.t('invalidConfigFile') + (config.version ? ` (Version ${config.version} not supported)`: ''));
                        }
                        
                        selectionManager.resetAllSelections(); 
                        state.selections = { ...state.selections, ...config.selections };
                        state.promptLanguage = config.promptLanguage || 'en';
                        state.promptDetailLevel = config.promptDetailLevel || 'standard';
                        state.aspectRatio = config.aspectRatio || '';
                        state.customAspectRatio = config.customAspectRatio || '';
                        state.selections.negativePrompt = config.selections.negativePrompt || ''; 
                        
                        elements.additionalDetails.value = state.selections.additionalDetails || '';
                        elements.negativePrompt.value = state.selections.negativePrompt;
                        elements.promptLanguageSelect.value = state.promptLanguage;
                        elements.promptDetailLevelSelect.value = state.promptDetailLevel;
                        elements.aspectRatioSelect.value = state.aspectRatio;
                        elements.customAspectRatioInput.value = state.customAspectRatio;
                        elements.customAspectRatioContainer.classList.toggle('hidden', state.aspectRatio !== 'custom');

                        if (state.selections.purpose) {
                            const card = Array.from(elements.purposeCards).find(c => c.dataset.purpose === state.selections.purpose);
                            if (card) { card.classList.add('selected'); card.setAttribute('aria-pressed', 'true'); }
                        }
                        if (state.selections.industry) {
                            const tag = Array.from(elements.industryTags).find(t => t.dataset.industry === state.selections.industry);
                            if (tag) { tag.classList.add('selected'); tag.setAttribute('aria-pressed', 'true'); }
                        }
                        if (state.selections.style) {
                            const card = Array.from(elements.styleCards).find(s => s.dataset.style === state.selections.style);
                            if (card) { card.classList.add('selected'); card.setAttribute('aria-pressed', 'true'); }
                        }
                        if (state.selections.color) {
                            const swatch = Array.from(elements.colorSwatches).find(cs => cs.dataset.color === state.selections.color);
                            if (swatch) { swatch.classList.add('selected'); swatch.setAttribute('aria-pressed', 'true'); }
                            else elements.colorSwatches.forEach(s => s.classList.remove('selected'));
                            elements.customColorInput.value = state.selections.color;
                            elements.customColorPreview.style.backgroundColor = state.selections.color;
                        }
                        
                        if (state.selections.componentIds && state.selections.componentIds.length > 0) {
                            componentManager.selectComponentsByIds(state.selections.componentIds);
                        } else {
                            componentManager.selectComponentsByIds([]); 
                        }

                        if (state.selections.templateId) {
                            templateManager.updateTemplateSelectionVisuals(state.selections.templateId);
                        } else {
                            templateManager.clearTemplateSelectionVisuals();
                        }
                        
                        selectionManager.updateAllDisplays();

                        if (config.openaiSettings) {
                            localStorage.setItem('openai_settings_v1.2', JSON.stringify(config.openaiSettings)); 
                            openAISettingsManager.loadSettings(); 
                        }
                        if (config.customKeywords) {
                            state.customKeywords = Array.isArray(config.customKeywords) ? config.customKeywords : [];
                            localStorage.setItem('customKeywords_v1.2', JSON.stringify(state.customKeywords));
                            keywordManager.renderKeywords(); 
                            keywordManager.renderCustomKeywordsList(); 
                        }
                        if (config.uiLanguage) i18nManager.setLanguage(config.uiLanguage);
                        if (config.theme) {
                            localStorage.setItem('theme', config.theme);
                            themeManager.loadSavedTheme();
                            themeManager.updateIcon();
                        }
                        showToast('configImported', 'success');
                    } catch (err) {
                        console.error("Error importing config:", err);
                        showToast(i18nManager.t('configImportError'), 'error', 5000, err.message);
                    } finally {
                        elements.importConfigFile.value = ''; 
                    }
                };
                reader.readAsText(file);
            }
        };

        // --- Tutorial Manager ---
        const tutorialManager = {
            init() {
                if (!state.hasSeenTutorial) {
                    elements.tutorialOverlay.classList.add('show');
                }
                elements.closeTutorialBtn.addEventListener('click', () => this.closeTutorial());
                elements.showHelpButton.addEventListener('click', () => elements.tutorialOverlay.classList.add('show'));
                elements.tutorialOverlay.addEventListener('click', (e) => { 
                    if (e.target === elements.tutorialOverlay) this.closeTutorial();
                });
            },
            closeTutorial() {
                elements.tutorialOverlay.classList.remove('show');
                state.hasSeenTutorial = true;
                localStorage.setItem('hasSeenTutorial_v1.2', 'true'); 
            }
        };
        
        // --- Surprise Me Functionality ---
        const surpriseMeManager = {
            init() {
                elements.randomSurpriseBtn.addEventListener('click', () => this.generateRandomSetup());
            },
            getRandomElement(arr) {
                if (!arr || arr.length === 0) return null;
                return arr[Math.floor(Math.random() * arr.length)];
            },
            generateRandomSetup() {
                selectionManager.resetAllSelections();

                const randomPurposeCard = this.getRandomElement(Array.from(elements.purposeCards));
                if (randomPurposeCard) selectionManager.handlePurposeSelection(randomPurposeCard);

                const randomIndustryTag = this.getRandomElement(Array.from(elements.industryTags));
                if (randomIndustryTag) selectionManager.handleIndustrySelection(randomIndustryTag);
                
                const randomStyleCard = this.getRandomElement(Array.from(elements.styleCards));
                if (randomStyleCard) selectionManager.handleStyleSelection(randomStyleCard);

                const randomColorSwatch = this.getRandomElement(Array.from(elements.colorSwatches));
                if (randomColorSwatch) selectionManager.handleColorSelection(randomColorSwatch);

                const numComponents = Math.floor(Math.random() * 3) + 1;
                const availableComponents = Array.from(elements.componentTagsElements);
                const selectedRandomComponentIds = [];
                for (let i = 0; i < numComponents && availableComponents.length > 0; i++) {
                    const randomIndex = Math.floor(Math.random() * availableComponents.length);
                    const randomComponent = availableComponents.splice(randomIndex, 1)[0];
                    if (randomComponent && randomComponent.dataset.componentId) {
                         selectedRandomComponentIds.push(randomComponent.dataset.componentId);
                    }
                }
                componentManager.selectComponentsByIds(selectedRandomComponentIds);

                elements.promptLanguageSelect.value = Math.random() > 0.5 ? 'en' : 'zh';
                state.promptLanguage = elements.promptLanguageSelect.value;
                const detailLevels = ['concise', 'standard', 'detailed'];
                elements.promptDetailLevelSelect.value = this.getRandomElement(detailLevels);
                state.promptDetailLevel = elements.promptDetailLevelSelect.value;
                
                const aspectRatios = ['', '16:9', '9:16', '1:1', '4:3']; 
                elements.aspectRatioSelect.value = this.getRandomElement(aspectRatios);
                state.aspectRatio = elements.aspectRatioSelect.value;
                elements.customAspectRatioContainer.classList.add('hidden'); 

                selectionManager.updateAllDisplays(); 
                showToast('randomSetupGenerated', 'info');
                wizardManager.moveToStep(4); 
            }
        };


        // --- App Initialization ---
        function initApp() {
            if (window.promptGeneratorInitialized_v1_2) return; 
            window.promptGeneratorInitialized_v1_2 = true;

            elements.currentYear.textContent = new Date().getFullYear();

            i18nManager.init(); 
            themeManager.init();
            wizardManager.init();
            selectionManager.init(); 
            componentManager.init(); 
            templateManager.init(); 
            keywordManager.init(); 
            historyManager.init(); 
            openAISettingsManager.init(); 
            promptManager.init(); 
            configManager.init();
            tutorialManager.init();
            surpriseMeManager.init();

            const defaultColorSwatch = Array.from(elements.colorSwatches).find(s => s.dataset.color === state.selections.color);
            if (defaultColorSwatch) { defaultColorSwatch.classList.add('selected'); defaultColorSwatch.setAttribute('aria-pressed', 'true'); }
            elements.customColorPreview.style.backgroundColor = state.selections.color;
            elements.customColorInput.value = state.selections.color;
            elements.generatedPrompt.value = i18nManager.t('clickGeneratePrompt'); 
        }

        document.addEventListener('DOMContentLoaded', initApp);
    })();
</script>
</html>
